-- Full curriculum for Practitioner GRC (BH-GRC-2) and Specialisations: IAM, Cloud, Advanced GRC.
-- Replaces placeholder modules and lessons with substantial, exam-ready content.
-- Course IDs: BH-GRC-2 = 000008, BH-SPEC-IAM = 000009, BH-SPEC-CLOUD = 00000a, BH-SPEC-GRC = 00000b.
-- Ensures the four courses exist (idempotent) so this migration works with or without 20260209150000_learning_tracks.

BEGIN;

-- Ensure the four courses exist (e.g. when DB was seeded without learning_tracks migration).
-- Omits track so this works even if 20260209150000 (which adds track) has not run.
INSERT INTO public.courses (id, code, title, description, level, required_tier_level, duration_hours, order_index, aligned_certifications) VALUES
  ('a0000000-0000-4000-8000-000000000008', 'BH-GRC-2', 'Practitioner Core: GRC', 'Governance, risk, and compliance. Risk management, policy development, and compliance frameworks. Aligned to ISC² SSCP and related GRC certifications.', 3, 2, 100, 5, ARRAY['ISC² SSCP']),
  ('a0000000-0000-4000-8000-000000000009', 'BH-SPEC-IAM', 'Specialisation: IAM', 'Identity and Access Management.', 4, 3, 120, 7, ARRAY['CISSP']),
  ('a0000000-0000-4000-8000-00000000000a', 'BH-SPEC-CLOUD', 'Specialisation: Cloud Security', 'Cloud security (AWS, Azure, GCP).', 4, 3, 120, 8, ARRAY['AWS Security', 'Microsoft SC-200']),
  ('a0000000-0000-4000-8000-00000000000b', 'BH-SPEC-GRC', 'Specialisation: Advanced GRC', 'Advanced governance, risk, and compliance. Aligned to CRISC.', 4, 3, 120, 9, ARRAY['CRISC'])
ON CONFLICT (code) DO NOTHING;

-- Remove placeholder content (lessons first due to FK, then modules)
DELETE FROM public.lessons
WHERE module_id IN (
  SELECT id FROM public.modules
  WHERE course_id IN (
    SELECT id FROM public.courses
    WHERE code IN ('BH-GRC-2', 'BH-SPEC-IAM', 'BH-SPEC-CLOUD', 'BH-SPEC-GRC')
  )
);
DELETE FROM public.modules
WHERE course_id IN (
  SELECT id FROM public.courses
  WHERE code IN ('BH-GRC-2', 'BH-SPEC-IAM', 'BH-SPEC-CLOUD', 'BH-SPEC-GRC')
);

-- ========== BH-GRC-2: MODULES ==========
INSERT INTO public.modules (id, course_id, title, description, order_index) VALUES
  ('d0000000-0000-4000-8000-000000000001', 'a0000000-0000-4000-8000-000000000008', 'GRC Foundations', 'Governance, risk, and compliance in the context of cybersecurity.', 1),
  ('d0000000-0000-4000-8000-000000000002', 'a0000000-0000-4000-8000-000000000008', 'Risk Management', 'Identification, assessment, treatment, and monitoring of risk.', 2),
  ('d0000000-0000-4000-8000-000000000003', 'a0000000-0000-4000-8000-000000000008', 'Policy and Control Frameworks', 'Policies, standards, and common frameworks.', 3),
  ('d0000000-0000-4000-8000-000000000004', 'a0000000-0000-4000-8000-000000000008', 'Compliance and Audit', 'Compliance programmes, audits, and reporting.', 4);

-- ========== BH-GRC-2: LESSONS (Module 1) ==========
INSERT INTO public.lessons (id, module_id, title, description, content_markdown, duration_minutes, order_index) VALUES
  ('e0000000-0000-4000-8000-000000000001', 'd0000000-0000-4000-8000-000000000001', 'What is GRC?', 'Governance, risk, and compliance defined.', E'# What is GRC?\n\n## Introduction\n\nThis lesson defines governance, risk, and compliance and how they work together in organisations. You will learn why GRC matters for security, how it supports decision-making and accountability, and how to tell the three apart in practice.\n\n## Objectives\n\nBy the end of this lesson you will be able to:\n\n- Define governance, risk, and compliance and how they differ.\n- Explain how GRC supports security and business objectives.\n- Describe the role of the practitioner in a GRC function.\n\n## Governance\n\n**Governance** is the set of structures, policies, and processes that direct and control the organisation. It answers: *Who is in charge? Who decides? How do we measure success?* In security, governance ensures that security strategy aligns with business goals and that roles and responsibilities are clear. The board and executive leadership set direction and appetite; the CISO and risk owners implement and report. Without clear governance, security efforts can be fragmented and accountability unclear.\n\n**Example:** A company adopts a policy that *all customer data must be encrypted at rest*. Governance is what made that decision (board or executive approval), who owns it (e.g. CISO), and how the organisation checks that it is being followed (reporting, audit).\n\n## Risk\n\n**Risk** is the effect of uncertainty on objectives. Risk management answers: *What could go wrong? How likely and how bad? What will we do about it?* It identifies what could go wrong, assesses likelihood and impact, and decides how to respond (accept, mitigate, transfer, or avoid). Security risk is a subset of organisational risk: threats to confidentiality, integrity, availability, and compliance. GRC practitioners help identify, assess, and report security risk so leadership can prioritise and fund controls.\n\n**Example:** A risk might be *unpatched servers could be exploited by ransomware*. Risk management identifies it, assesses likelihood (e.g. medium) and impact (e.g. high), and decides to mitigate by patching and monitoring—or to accept residual risk with documented approval.\n\n## Compliance\n\n**Compliance** means meeting legal, regulatory, and contractual obligations. Organisations must comply with laws (e.g. data protection), industry standards (e.g. payment card rules), and contracts (e.g. security and privacy clauses). Compliance drives many security controls; GRC practitioners map controls to requirements, collect evidence, and support audits.\n\n**Example:** A regulation says *personal data must be protected*. Compliance work involves mapping that to controls (e.g. encryption, access control), collecting evidence that those controls are in place and operating, and presenting that evidence to auditors or regulators.\n\n## How the three differ\n\n| | Governance | Risk | Compliance |\n|--|------------|------|------------|\n| **Focus** | Who decides; accountability | What could go wrong; response | Meeting obligations; evidence |\n| **Typical output** | Policies, roles, reporting lines | Risk register, treatment plans | Control mapping, evidence, audit readiness |\n| **Key question** | Who owns this? | How do we treat this risk? | Can we prove we meet this requirement? |\n\n## How GRC fits together\n\nGovernance sets the framework (policies, roles, appetite). Risk management identifies what to address and how (accept, mitigate, transfer, avoid). Compliance ensures the organisation meets its obligations and can demonstrate that to regulators and partners. Together they create a coherent approach: accountable, risk-based, and demonstrable.\n\n## In practice\n\nImagine you join a mid-size company as a GRC analyst. You will typically see: **governance** in the form of an information security policy approved by the board and a risk committee that meets quarterly; **risk** in a risk register with items like *insider threat* or *cloud misconfiguration* and owners and due dates; **compliance** in control matrices mapping to a framework (e.g. ISO 27001 or a regulation) and folders of evidence for audits. Your job is to support all three: keep the register current, help collect evidence, and report status so leadership can make decisions.\n\n## Key takeaway\n\nGRC combines governance (direction and accountability), risk (uncertainty and response), and compliance (meeting obligations). Practitioners support all three to align security with business and regulatory needs.\n\n## Exam alignment\n\nISC² SSCP (Security Operations; risk, compliance).', 32, 1),
  ('e0000000-0000-4000-8000-000000000002', 'd0000000-0000-4000-8000-000000000001', 'The Role of Security in the Organisation', 'How security supports business and reports to leadership.', E'# The Role of Security in the Organisation\n\n## Introduction\n\nThis lesson explains how the security function fits within the organisation and how it communicates with leadership and other teams. You will learn reporting lines, key stakeholders, and how to position security as an enabler so you can navigate your role effectively.\n\n## Objectives\n\nBy the end of this lesson you will be able to:\n\n- Describe typical reporting lines for security (CISO, risk, IT).\n- Identify key stakeholders: board, executives, legal, HR, IT, business units.\n- Explain how to communicate security value in business terms.\n\n## Where security sits\n\nThe security function may report to the chief information security officer (CISO), who often reports to the CEO, COO, or CIO. In some organisations security sits under IT; in others it is a separate function. Governance defines escalation paths and who approves policy and major risk decisions. Understanding the structure helps you know who to inform and who can authorise change.\n\n**Example:** In a bank, the CISO might report to the CEO or the chief risk officer (CRO). In a tech startup, security might sit under the CTO. In both cases, the board or audit committee typically receives risk and compliance reports—so your work may flow upward through the CISO to that level.\n\n## Stakeholders and what they need\n\n| Stakeholder | Typical needs from security/GRC |\n|-------------|--------------------------------|\n| **Board / audit committee** | Strategic risk posture, major incidents, compliance and audit status, resource asks |\n| **Executives (CEO, COO, CIO)** | Operational risk, open findings, decisions needed (e.g. risk acceptance) |\n| **Legal / compliance** | Evidence of controls, breach implications, regulatory and audit support |\n| **HR** | Policy enforcement, awareness metrics, insider risk (with appropriate boundaries) |\n| **IT** | Control requirements, implementation support, vulnerability and patch context |\n| **Business units** | Clear policy and process; help meeting contractual or regulatory obligations |\n\nGRC practitioners work with all of these to gather information, report status, and support decisions. Building trust with each group makes it easier to get accurate input and to get action on remediation.\n\n## Communicating value\n\nSecurity is more effective when framed in business terms: protection of revenue, reputation, and legal standing; enablement of contracts and partnerships; and reduction of loss. Use metrics (e.g. open high/critical findings, audit results, incidents) and tie recommendations to risk and business impact so leadership can prioritise.\n\n**How to do it:** (1) Lead with the business impact (e.g. *This finding could affect our ability to sign enterprise contracts*). (2) Give one or two clear metrics (e.g. *We have 3 open critical audit findings; 2 have owners and dates*). (3) State the ask (e.g. *We need approval to accept risk on X or budget for Y*).\n\n## In practice\n\nWhen the board asks for a one-pager on *cyber risk*, they usually want: current posture (e.g. red/amber/green or similar), top 3–5 risks, what is being done, and what decisions or resources are needed. As a practitioner, you may be asked to draft the risk and compliance sections. Keep language simple, avoid jargon, and put the main message and any ask at the top.\n\n## Key takeaway\n\nSecurity supports the organisation through clear governance, risk-based decisions, and compliance. Building relationships with stakeholders and communicating in business terms increases influence and resourcing.\n\n## Exam alignment\n\nISC² SSCP (Security Operations; organisational context).', 28, 2),
  ('e0000000-0000-4000-8000-000000000003', 'd0000000-0000-4000-8000-000000000001', 'Ethics and Professional Conduct', 'Ethical behaviour and professional standards in GRC.', E'# Ethics and Professional Conduct\n\n## Introduction\n\nThis lesson covers ethical behaviour and professional standards for GRC and security practitioners. You will learn why ethics matter, how to handle conflicts and sensitive information, and a simple process for ethical decisions.\n\n## Objectives\n\nBy the end of this lesson you will be able to:\n\n- Explain why ethics and professional conduct matter in GRC.\n- Describe how to handle conflicts of interest and confidential information.\n- Apply a simple ethical decision-making approach.\n\n## Why ethics matter\n\nGRC practitioners handle sensitive information: risk assessments, audit findings, incidents, and personal data. They may influence decisions about resource allocation, risk acceptance, and disciplinary action. Acting with integrity protects the organisation, builds trust, and reduces legal and reputational risk. Professional bodies and employers expect adherence to a code of ethics.\n\n**Example:** You are preparing a risk report for the board. If you downplay a risk to avoid embarrassing a colleague, you are compromising the board''s ability to make an informed decision—and your own credibility. Ethics means presenting the facts fairly and escalating when you are asked to misrepresent them.\n\n## Conflicts of interest\n\nA **conflict of interest** exists when personal interests could influence or appear to influence professional judgement. Examples: assessing a system you helped build; having a financial interest in a vendor; favouring a friend''s department in an audit. Disclose conflicts to your manager or compliance; recuse yourself from decisions where appropriate; document the approach.\n\n**How to handle it:** (1) Recognise the conflict (would a reasonable person question your objectivity?). (2) Disclose in writing to your manager or compliance. (3) Follow their direction—often recusal from the specific decision or assessment. (4) Do not participate in or influence the outcome. (5) Document what you disclosed and how it was handled.\n\n## Handling confidential information\n\nTreat risk and compliance information as confidential. Share only with those who need it for their role; use secure channels; do not discuss in public or on unsecured devices. Follow data classification and retention policies. In audits, protect the confidentiality of evidence and findings within the scope of the audit report.\n\n**In practice:** Audit findings or incident details might be highly sensitive. Only share on a need-to-know basis; use approved channels (e.g. secure collaboration, not personal email); and do not discuss in open offices or on public transport. If someone asks for information they are not authorised to have, refer them to the document owner or your manager.\n\n## Ethical decision-making: simple steps\n\n1. **Identify** the issue and who is affected.\n2. **Refer** to policy, code of conduct, and applicable law.\n3. **Consider** options and consequences (including *what if this became public?*).\n4. **Seek guidance** from your manager, legal, or an ethics officer when in doubt.\n5. **Document** the decision and rationale.\n6. **Escalate** when you are uncomfortable or when the right thing is unclear.\n\nWhen in doubt, escalate. It is better to raise a concern than to act and later discover you crossed a line.\n\n## Key takeaway\n\nEthics and professional conduct are foundational. Disclose conflicts, protect confidential information, and use a structured approach when making ethical decisions.\n\n## Exam alignment\n\nISC² SSCP (Ethics; professional conduct).', 26, 3);

-- ========== BH-GRC-2: LESSONS (Module 2 — Risk Management) ==========
INSERT INTO public.lessons (id, module_id, title, description, content_markdown, duration_minutes, order_index) VALUES
  ('e0000000-0000-4000-8000-000000000004', 'd0000000-0000-4000-8000-000000000002', 'Risk Identification', 'How to identify and catalogue risks.', E'# Risk Identification\n\n## Introduction\n\nThis lesson covers how to identify risks to the organisation: assets, threats, vulnerabilities, and scenarios. You will learn sources of risk information, how to document and categorise risks, and how to write one clear risk scenario you could add to a register.\n\n## Objectives\n\nBy the end of this lesson you will be able to:\n\n- Identify assets, threats, and vulnerabilities relevant to security.\n- Use sources such as threat intelligence, audits, and incidents to find risks.\n- Document and categorise risks for assessment.\n\n## Assets and what we protect\n\n**Assets** are what the organisation values and must protect: data (customer, financial, intellectual property), systems (applications, infrastructure), people, and reputation. Risk identification starts by listing critical assets and their owners. Asset inventories and data classification support this.\n\n**Example:** For a retail company, critical assets might include: customer payment data (PCI scope), customer PII, the e-commerce platform, and the warehouse management system. Each has an owner (e.g. Head of E-commerce, Head of Operations) who can help you understand impact if the asset is compromised.\n\n## Threats and vulnerabilities\n\n**Threats** are potential causes of harm: threat actors (attackers, insiders), natural events (fire, flood), and failures (system failure, human error). **Vulnerabilities** are weaknesses that threats can exploit: unpatched software, weak access controls, misconfigurations. Identify threats from threat intelligence, incident history, and industry reports; identify vulnerabilities from scans, audits, and assessments.\n\n| Threat type | Example | Typical vulnerability |\n|-------------|--------|------------------------|\n| External attacker | Ransomware, phishing | Unpatched systems, weak MFA, open RDP |\n| Insider | Theft of data, sabotage | Overprivileged access, lack of DLP |\n| Third party | Supply chain compromise | Weak vendor assessment, shared credentials |\n| Failure / error | Outage, misconfiguration | Single points of failure, missing change control |\n\n## Risk scenarios\n\nA **risk scenario** describes a specific way harm could occur. It links threat + vulnerability + asset + impact. Use scenarios to prioritise and communicate risk.\n\n**Example scenario:** *An attacker exploits a critical unpatched vulnerability in the customer-facing web application to gain access to the database containing PII; resulting in a data breach, regulatory fines, and reputational damage.* This gives assessors a clear picture for likelihood and impact.\n\n## How to identify risks: practical steps\n\n1. **List critical assets** (from inventory or workshops) and assign owners.\n2. **Gather threats** from threat intelligence, past incidents, and industry news.\n3. **Gather vulnerabilities** from vulnerability scans, audit findings, and architecture reviews.\n4. **Build scenarios** by combining threat + vulnerability + asset; write one sentence per risk.\n5. **Categorise** (e.g. cyber, operational, third-party) and **document** in a consistent format (ID, description, asset, category, source) ready for assessment.\n\n## Sources and documentation\n\nSources include: **internal** — incidents, audits, risk registers, change logs; **external** — threat intelligence, advisories, breach reports; **structured** — interviews, workshops, checklists. Document each risk with a clear description, affected assets, and initial categorisation so the next step (assessment) can be consistent.\n\n## In practice\n\nWhen joining a new team, you might be asked to *add one new risk* to the register. Pick one real threat (e.g. from a recent advisory) and one asset your organisation has; state the scenario in one sentence and which control or gap it relates to. That single row is often enough to show you understand identification.\n\n## Key takeaway\n\nRisk identification catalogues what could go wrong by considering assets, threats, vulnerabilities, and scenarios. Use internal and external sources and document clearly for assessment.\n\n## Exam alignment\n\nISC² SSCP (Risk identification; asset management).', 35, 1),
  ('e0000000-0000-4000-8000-000000000005', 'd0000000-0000-4000-8000-000000000002', 'Risk Assessment', 'Assessing likelihood and impact.', E'# Risk Assessment\n\n## Introduction\n\nThis lesson covers how to assess the likelihood and impact of identified risks and combine them into a risk level. You will learn qualitative and basic quantitative methods, how to use a risk matrix, and how to complete one row of a risk register.\n\n## Objectives\n\nBy the end of this lesson you will be able to:\n\n- Define likelihood and impact and assign levels (e.g. high, medium, low).\n- Use a risk matrix to derive risk level.\n- Explain the difference between qualitative and quantitative assessment.\n\n## Likelihood and impact\n\n**Likelihood** (or probability) is how likely the risk event is to occur. It can be expressed in categories (e.g. rare, possible, likely) or, in quantitative approaches, as a probability. Factors include threat activity, vulnerability exploitability, and existing controls. **Impact** is the consequence if the risk occurs: financial loss, operational disruption, reputational damage, legal or regulatory impact. Impact can be categorised (e.g. low, medium, high, critical) or estimated in currency or downtime.\n\n**Example — likelihood:** *Ransomware on the file server* might be *likely* if the organisation has had phishing incidents and some servers are behind on patches; or *possible* if controls are strong and no recent targeting. **Example — impact:** The same risk might be *high* impact if the file server holds critical business data and backups are not fully tested; or *medium* if recovery is well rehearsed and data is replicated.\n\n## Risk matrix\n\nA **risk matrix** combines likelihood and impact to produce a **risk level** (e.g. 1–5 or low/medium/high/critical). The matrix helps prioritise: critical and high risks are typically addressed first. Organisations define their own scales and thresholds.\n\n|  | Low impact | Medium impact | High impact | Critical impact |\n|--|------------|---------------|-------------|------------------|\n| **Likely** | Medium | High | High | Critical |\n| **Possible** | Low | Medium | High | Critical |\n| **Rare** | Low | Low | Medium | High |\n\n*Example:* Likely + High impact → **High** risk (prioritise treatment). Rare + Low impact → **Low** risk (may accept with approval).\n\n## How to assess one risk: steps\n\n1. **Describe** the risk scenario clearly (from identification).\n2. **Set likelihood** using your organisation''s scale (e.g. 1–5 or Rare/Possible/Likely). Consider: Have we seen this before? How active is the threat? How exposed are we?\n3. **Set impact** using your organisation''s scale. Consider: Financial loss, downtime, reputation, legal/regulatory.\n4. **Look up** the risk level in the matrix.\n5. **Document** rationale (one or two sentences) so others can understand and so the assessment can be reviewed later.\n\n## Qualitative vs quantitative\n\n**Qualitative assessment** uses categories and expert judgement (e.g. "high", "medium"). It is faster and easier to apply consistently across many risks. **Quantitative assessment** uses numbers (e.g. expected loss in currency, annual loss expectancy). It supports cost-benefit analysis but requires data and can be complex. Many organisations use qualitative for most risks and quantitative for a subset where data exists.\n\n## Consistency and bias\n\nUse consistent criteria and definitions so assessments are comparable. Avoid common biases: overconfidence, anchoring on past events, or underweighting rare but severe events. Calibrate with historical data and peer review where possible.\n\n## In practice\n\nYou might be given a scenario in an exam or at work: *Unpatched internet-facing server; critical vulnerability known to be exploited.* You would assess likelihood as at least *possible* (or *likely* if the threat is active) and impact as *high* or *critical* depending on what the server holds—giving a **high** or **critical** risk level and a clear need to patch or isolate.\n\n## Key takeaway\n\nRisk assessment estimates likelihood and impact and combines them into a risk level. Use a risk matrix and consistent criteria; choose qualitative or quantitative methods to fit the context.\n\n## Exam alignment\n\nISC² SSCP (Risk assessment; risk analysis).', 32, 2),
  ('e0000000-0000-4000-8000-000000000006', 'd0000000-0000-4000-8000-000000000002', 'Risk Treatment and Monitoring', 'Responding to risk and tracking over time.', E'# Risk Treatment and Monitoring\n\n## Introduction\n\nThis lesson covers how organisations respond to risk (treatment options) and how they monitor risk over time. You will learn the four treatment options, how to document a treatment plan, and the role of risk registers and reviews.\n\n## Objectives\n\nBy the end of this lesson you will be able to:\n\n- List and describe the four risk treatment options: accept, mitigate, transfer, avoid.\n- Document risk treatment plans and ownership.\n- Explain how risk is monitored and when to reassess.\n\n## Risk treatment options\n\n| Option | Meaning | When to use |\n|--------|---------|-------------|\n| **Accept** | Consciously accept the risk | Low impact, or cost of control exceeds the risk; must be documented and approved |\n| **Mitigate** | Reduce likelihood or impact with controls | Most common for security risk (patch, monitor, restrict access) |\n| **Transfer** | Shift some impact to another party | Insurance, contracts; does not remove the risk |\n| **Avoid** | Stop the activity that creates the risk | Risk unacceptable and cannot be sufficiently mitigated or transferred |\n\n**Example — Mitigate:** *Ransomware risk on file server* → Patch servers, enforce MFA, segment network, maintain and test backups. **Example — Transfer:** Same risk → Cyber insurance to cover recovery and ransom negotiation costs (still mitigate where possible). **Example — Accept:** *Low-impact, rare risk* → Document in register, get manager sign-off, review in 12 months.\n\n## Treatment plans\n\nFor each risk that is mitigated, define: **actions** (what will be done), **owner** (who is responsible), **deadline**, and **how effectiveness will be verified**. Track progress in a risk register or project plan. Escalate when owners miss deadlines or when risk level increases.\n\n**How to document one treatment plan:**\n\n1. Risk ID and one-line description.\n2. Treatment option chosen (e.g. Mitigate).\n3. Actions: e.g. *Implement MFA for all admin accounts; complete by Q2.*\n4. Owner: name or role.\n5. Verification: e.g. *Control test: MFA enabled for 100% of admin accounts.*\n\n## Monitoring and review\n\nRisk is dynamic: new threats, changes in the environment, and control effectiveness change risk over time. **Monitoring** includes: tracking treatment progress; reviewing incidents and near-misses; updating when assets or threats change. **Review** cycles (e.g. quarterly risk committee, annual risk assessment) ensure the register is current and priorities are still correct. Key risk indicators (KRIs) can signal when risk exposure is increasing.\n\n## In practice\n\nWhen a risk owner says *we''re working on it*, the register should still show a concrete action and date. *Implement MFA by 30 June* is actionable; *Improve security* is not. At review meetings, use the register to ask: *Which high/critical risks have no owner or missed deadline?* Those are the ones that need escalation.\n\n## Key takeaway\n\nRisk treatment chooses among accept, mitigate, transfer, and avoid. Document plans and ownership; monitor and review regularly so risk decisions stay current.\n\n## Exam alignment\n\nISC² SSCP (Risk response; monitoring).', 30, 3);

-- ========== BH-GRC-2: LESSONS (Module 3 — Policy and Control Frameworks) ==========
INSERT INTO public.lessons (id, module_id, title, description, content_markdown, duration_minutes, order_index) VALUES
  ('e0000000-0000-4000-8000-000000000007', 'd0000000-0000-4000-8000-000000000003', 'Policies, Standards, and Procedures', 'The hierarchy of governance documents.', E'# Policies, Standards, and Procedures\n\n## Introduction\n\nThis lesson explains the difference between policies, standards, and procedures and how they form a hierarchy of governance documents. You will learn how to write and maintain them so they are clear and enforceable, and how to trace one control back to a policy.\n\n## Objectives\n\nBy the end of this lesson you will be able to:\n\n- Distinguish policies, standards, and procedures and give examples.\n- Describe the approval and review cycle for governance documents.\n- Explain how to make documents clear and auditable.\n\n## Policies\n\n**Policies** are high-level statements of what the organisation expects. They are approved by leadership (e.g. board or executive) and set the tone and direction. Examples: *The organisation protects confidential data*; *Access to systems is granted based on role and need.* Policies do not specify technical details; they mandate outcomes and accountability. They are relatively stable and reviewed periodically (e.g. annually).\n\n## Standards\n\n**Standards** define specific requirements that support policies. They may be set by the organisation or by external bodies (e.g. password length, encryption algorithms, retention periods). Standards are more detailed than policies and may change more often as technology or regulation changes. Example: *Passwords must be at least 12 characters and include complexity requirements.*\n\n## Procedures\n\n**Procedures** (or runbooks) are step-by-step instructions for performing tasks. They ensure consistency and support training and audits. Examples: how to grant access, how to handle an incident, how to conduct a risk assessment. Procedures should be clear, actionable, and updated when processes change.\n\n## Hierarchy and traceability\n\n| Level | Purpose | Example |\n|-------|---------|--------|\n| **Policy** | What we expect; who is accountable | *We protect confidential data.* |\n| **Standard** | Specific requirement | *Confidential data must be encrypted at rest (AES-256).* |\n| **Procedure** | Step-by-step how-to | *How to enable encryption for new databases.* |\n\nPolicies drive standards; standards drive procedures. Controls implemented in the organisation should be traceable to a policy or standard. This traceability supports audits: auditors can follow from policy → standard → procedure → control → evidence.\n\n**Example of traceability:** Audit asks *How do you ensure access is appropriate?* You point to: *Access Control Policy* (policy) → *Access Management Standard* (e.g. role-based access, review every 90 days) → *User Access Review Procedure* (steps and roles) → evidence (review logs, tickets).\n\n## Approval and review\n\nPolicies: typically board or C-suite approval; review every 1–2 years. Standards: often security or risk owner; review when technology or regulation changes. Procedures: process owner; review when the process changes. Document version, approval date, and next review date so auditors and staff know what is current.\n\n## In practice\n\nWhen asked *Why do we have this control?*, you should be able to name the policy or standard it supports. If you cannot, the control may be orphaned or the documentation needs updating. One simple check: for each control in your scope, write one sentence: *This control supports [Policy X] by [Standard Y].*\n\n## Key takeaway\n\nPolicies set direction; standards set requirements; procedures set steps. Maintain clear hierarchy and traceability for accountability and audits.\n\n## Exam alignment\n\nISC² SSCP (Policies; security program).', 30, 1),
  ('e0000000-0000-4000-8000-000000000008', 'd0000000-0000-4000-8000-000000000003', 'Control Frameworks', 'Using NIST, ISO, and other frameworks.', E'# Control Frameworks\n\n## Introduction\n\nThis lesson introduces common control frameworks that organisations use to structure their security and compliance efforts. You will learn how frameworks are used, how they differ, and how to map one organisational control to one framework requirement.\n\n## Objectives\n\nBy the end of this lesson you will be able to:\n\n- Name and describe the purpose of common frameworks (e.g. NIST, ISO).\n- Explain how organisations select and apply frameworks.\n- Map organisational controls to framework requirements.\n\n## Why frameworks\n\nFrameworks provide a structured set of controls and practices so organisations do not start from scratch. They reflect industry and regulatory expectations and support consistency and benchmarking. Many regulations and contracts reference or require alignment with a framework.\n\n## NIST\n\nThe **NIST Cybersecurity Framework (CSF)** has five functions: **Identify**, **Protect**, **Detect**, **Respond**, **Recover**. It is risk-based and adaptable to sector and size. **NIST SP 800-53** is a catalogue of controls used by US federal and many other organisations. Controls are grouped by family (e.g. access control, audit).\n\n**Example — mapping to NIST CSF:** Your organisation uses multi-factor authentication (MFA) for administrative access. That maps to CSF *Protect* (Identity Management and Access Control). You might document: *Control: MFA for all privileged accounts. Framework: NIST CSF PR.AC-7.*\n\n## ISO/IEC 27001\n\n**ISO/IEC 27001** is an international standard for information security management systems (ISMS). It requires the organisation to define scope, assess risk, select controls from ISO 27002 (Annex A), and implement, monitor, and improve. Certification involves an external audit. Many organisations use it to demonstrate a structured security programme.\n\n**Example — mapping to ISO:** The same MFA control could map to **A.5.18 Access control** (or the equivalent in your version of Annex A). One control often satisfies multiple framework requirements; document each mapping so you can report to different stakeholders (e.g. ISO auditor, US customer).\n\n## Framework comparison (high level)\n\n| Framework | Focus | Typical use |\n|-----------|--------|-------------|\n| **NIST CSF** | Risk-based; 5 functions | Broad security programme; US government / sector |\n| **NIST SP 800-53** | Control catalogue | Federal; detailed control set |\n| **ISO 27001** | ISMS; Annex A controls | Certification; international; contracts |\n| **CIS Controls** | Prioritised actions | Implementation priority; defence in depth |\n| **PCI-DSS** | Payment card data | Cardholder data environment |\n\nOrganisations often map one framework to another (e.g. NIST to ISO) to satisfy multiple requirements with one control set.\n\n## How to map one control to a framework\n\n1. **Choose** the framework (e.g. NIST CSF or ISO Annex A).\n2. **Find** the requirement that matches what your control does (e.g. access control, encryption).\n3. **Document** in a matrix: Control name | Framework | Requirement ID | How we meet it | Evidence.\n4. **Identify gaps** where a requirement has no control or weak evidence.\n\n## In practice\n\nA customer or auditor may ask *Are you NIST aligned?* or *Do you have ISO 27001?* You need to be able to say *We map our controls to [framework]* and show a control matrix or evidence pack. One control (e.g. MFA) can appear in multiple rows for different frameworks—that is normal and reduces duplicate work.\n\n## Key takeaway\n\nFrameworks (NIST, ISO, CIS, etc.) provide a structured set of controls. Map organisational controls to frameworks to identify gaps and satisfy regulatory and partner requirements.\n\n## Exam alignment\n\nISC² SSCP (Security operations; control frameworks).', 32, 2),
  ('e0000000-0000-4000-8000-000000000009', 'd0000000-0000-4000-8000-000000000003', 'Security Controls and Control Types', 'Preventive, detective, corrective, and compensatory controls.', E'# Security Controls and Control Types\n\n## Introduction\n\nThis lesson covers the types of security controls and how they are classified by function and implementation. You will learn how to select and document controls for risk treatment and compliance, and how to classify one control in both dimensions.\n\n## Objectives\n\nBy the end of this lesson you will be able to:\n\n- Classify controls by function: preventive, detective, corrective, deterrent, compensatory.\n- Classify controls by implementation: technical, administrative, physical.\n- Document controls for risk and compliance purposes.\n\n## Control functions\n\n| Function | Purpose | Example |\n|----------|---------|--------|\n| **Preventive** | Stop an incident from occurring | Firewall; access control; encryption |\n| **Detective** | Identify when something has happened | IDS; logging; audit trails; monitoring |\n| **Corrective** | Fix or limit damage after an incident | Patches; backups; incident response |\n| **Deterrent** | Discourage attacks | Warnings; visible monitoring; policies |\n| **Compensating** | Alternative when primary control cannot be applied | Extra monitoring when a patch cannot be installed |\n\n**Example:** For *unauthorised access to the network*, a **preventive** control is a firewall and access list; a **detective** control is network monitoring and log review; a **corrective** control is incident response and revoking access. Using more than one type is defence in depth.\n\n## Technical, administrative, physical\n\n**Technical** controls are implemented in technology (firewalls, encryption, access controls). **Administrative** controls are policies, procedures, and training. **Physical** controls protect facilities and hardware (locks, badges, environmental controls). A complete programme uses all three.\n\n**Example — one risk, multiple control types:** To protect the server room: **physical** — locked door, badge access; **technical** — access logs, camera; **administrative** — access policy, visitor procedure. Documenting all three shows auditors and risk owners that the control set is layered.\n\n## Documenting one control\n\nFor each control, document: **name and description**; **function** (preventive/detective/etc.); **implementation** (technical/administrative/physical); **which risk or requirement** it addresses; **owner**; **how it is tested or evidenced**. This supports risk registers, compliance mapping, and audits.\n\n**Worked example:** *Control: Multi-factor authentication for privileged accounts. Function: Preventive. Implementation: Technical. Addresses: Unauthorised access / privilege escalation. Owner: IAM team. Evidence: MFA report showing 100% coverage for privileged accounts; sample of login logs.*\n\n## In practice\n\nWhen an auditor asks *What controls do you have for X?*, you should be able to name at least one preventive and one detective control where appropriate, and say whether each is technical, administrative, or physical. If you only have one control type (e.g. only preventive), that is a gap to note for defence in depth.\n\n## Key takeaway\n\nControls can be classified by function (prevent, detect, correct, deter, compensate) and implementation (technical, administrative, physical). Document controls clearly for risk and compliance.\n\n## Exam alignment\n\nISC² SSCP (Security controls; implementation).', 28, 3);

-- ========== BH-GRC-2: LESSONS (Module 4 — Compliance and Audit) ==========
INSERT INTO public.lessons (id, module_id, title, description, content_markdown, duration_minutes, order_index) VALUES
  ('e0000000-0000-4000-8000-00000000000a', 'd0000000-0000-4000-8000-000000000004', 'Compliance Programmes', 'Building and running a compliance programme.', E'# Compliance Programmes\n\n## Introduction\n\nThis lesson covers how to build and run a compliance programme: identifying obligations, mapping controls, collecting evidence, and managing findings. You will learn the lifecycle of compliance and how to map one control to one requirement and collect one piece of evidence.\n\n## Objectives\n\nBy the end of this lesson you will be able to:\n\n- List typical compliance obligations (legal, regulatory, contractual).\n- Describe how to map controls to requirements and collect evidence.\n- Explain how to prioritise and remediate compliance gaps.\n\n## Compliance obligations\n\nOrganisations must comply with **laws** (e.g. data protection, sector-specific regulation), **regulatory** requirements (e.g. financial services, healthcare), and **contractual** obligations (e.g. security and privacy clauses in customer or vendor contracts). Maintain an inventory of obligations, owners, and due dates (e.g. audit deadlines, renewal dates).\n\n**Example:** A company might have: GDPR (legal), PCI-DSS if it processes cards (contractual/regulatory), and a contract clause requiring *encryption of data at rest* (contractual). Each obligation has specific requirements that must be mapped to controls and evidenced.\n\n## Mapping and evidence\n\n**Mapping** links each obligation to the controls that satisfy it. One control may satisfy multiple requirements; one requirement may need several controls. **Evidence** is the proof that controls are in place and operating: screenshots, reports, logs, policy documents, training records. Collect and store evidence in a structured way so it can be retrieved for audits and reviews.\n\n**How to map one requirement to one control:** (1) Take one requirement (e.g. *Personal data must be encrypted at rest*). (2) Identify the control (e.g. *Database encryption for all systems holding PII*). (3) Document: Requirement ID | Control name | How we meet it | Evidence (e.g. *Screenshot of encryption settings; policy section 4.2*). (4) Store evidence in a designated folder or tool with a clear naming convention.\n\n## Gap management\n\nA **gap** is a requirement that is not fully satisfied. Identify gaps through self-assessment or internal audit; prioritise by risk and regulatory impact; remediate with a plan (owner, deadline, verification). Track gaps in a register and escalate when deadlines are missed or risk is high.\n\n| Step | Action |\n|------|--------|\n| Identify | Self-assessment or audit finding |\n| Prioritise | By regulatory impact, risk, and due date |\n| Plan | Owner, actions, deadline, verification |\n| Track | Register with status and escalation |\n| Close | Evidence of remediation; request closure |\n\n## In practice\n\nWhen an auditor asks *How do you meet requirement X?*, you should be able to: (1) point to the control that addresses it, (2) show the mapping document, and (3) produce the evidence (e.g. policy, screenshot, log extract). If you cannot do all three, that is a gap—either the control is missing, the mapping is incomplete, or the evidence is not collected.\n\n## Key takeaway\n\nA compliance programme identifies obligations, maps controls, collects evidence, and manages gaps. Structure and consistency support audits and reduce regulatory risk.\n\n## Exam alignment\n\nISC² SSCP (Compliance; security program).', 30, 1),
  ('e0000000-0000-4000-8000-00000000000b', 'd0000000-0000-4000-8000-000000000004', 'Internal and External Audit', 'How audits work and how to prepare.', E'# Internal and External Audit\n\n## Introduction\n\nThis lesson explains how internal and external audits work, what auditors look for, and how to prepare. You will learn the audit lifecycle, how to prepare for fieldwork, and how to respond to findings.\n\n## Objectives\n\nBy the end of this lesson you will be able to:\n\n- Distinguish internal from external audit and describe their purposes.\n- Explain the audit process: planning, fieldwork, reporting, follow-up.\n- Describe how to prepare for an audit and respond to findings.\n\n## Internal vs external audit\n\n**Internal audit** is performed by or for the organisation to assess control effectiveness and support improvement. It is independent of the functions it audits and reports to the board or audit committee. **External audit** is performed by a third party (e.g. for certification, regulatory requirement, or customer assurance). External auditors provide an independent opinion; they may certify (e.g. ISO 27001) or report on control design and operation.\n\n| | Internal audit | External audit |\n|--|----------------|----------------|\n| **Who** | Organisation''s own team or co-sourced | Independent third party |\n| **Purpose** | Improvement; assurance to board | Certification; regulatory; customer |\n| **Output** | Report to management/board | Opinion; certificate; report |\n\n## Audit process\n\n**Planning** — Scope, criteria (e.g. framework or regulation), and schedule are agreed. **Fieldwork** — Auditors request evidence, interview staff, and test controls. **Reporting** — Findings (gaps, weaknesses) are documented with severity and recommendation. **Follow-up** — Management responds with remediation plans; auditors may verify closure.\n\n## How to prepare for an audit\n\n1. **Gather** the control matrix and evidence pack: each requirement, control, and evidence item in one place.\n2. **Check** that evidence is current (e.g. from this year), complete, and traceable (e.g. *Requirement 4.2 → Control: Encryption at rest → Evidence: doc 4.2.1*).\n3. **Designate** a single point of contact for the auditors and ensure they know who owns each control.\n4. **Rehearse** answering *How do you meet [requirement X]?* with control + evidence.\n5. **Be transparent**: if something is missing, say so and explain the plan; do not hide gaps.\n\n## Responding to findings\n\nAccept the finding or contest with evidence; assign an owner and deadline for remediation; implement fixes and collect evidence; request closure when complete. Track findings in a register so nothing is lost and senior management can monitor progress.\n\n**In practice:** When you receive a finding, document: Finding ID | Description | Owner | Due date | Actions | Status. Update status as work progresses and when you submit evidence for closure. Escalate if the owner cannot meet the deadline or if the finding is critical.\n\n## Key takeaway\n\nInternal audit supports improvement; external audit provides independent assurance. Prepare with organised evidence and clear ownership; respond to findings with plans and follow-through.\n\n## Exam alignment\n\nISC² SSCP (Audit; compliance).', 30, 2),
  ('e0000000-0000-4000-8000-00000000000c', 'd0000000-0000-4000-8000-000000000004', 'Reporting and Metrics', 'Reporting risk and compliance to leadership.', E'# Reporting and Metrics\n\n## Introduction\n\nThis lesson covers how to report risk and compliance status to leadership and the board. You will learn what metrics to use, how to structure a one-pager, and how reporting supports accountability and decisions.\n\n## Objectives\n\nBy the end of this lesson you will be able to:\n\n- Choose metrics that reflect risk and compliance health.\n- Structure reports for different audiences (executives, board).\n- Explain how reporting supports accountability and decisions.\n\n## Metrics for GRC\n\nUseful metrics include: **risk** — number of open high/critical risks, trend over time, ageing of open items; **compliance** — audit findings open/closed, control test pass rates, certification status; **operations** — incidents, mean time to detect/remediate, control coverage. Metrics should be consistent, measurable, and actionable. Avoid vanity metrics that do not drive decisions.\n\n| Area | Example metrics | Why useful |\n|------|-----------------|------------|\n| Risk | Open high/critical risks; overdue treatment items | Shows workload and exposure |\n| Compliance | Open audit findings; % controls tested and passed | Shows audit readiness and gaps |\n| Operations | Incidents; MTTR; control coverage % | Shows day-to-day health |\n\n## Reporting structure\n\n**Executive reports** are concise: status (red/amber/green or similar), key metrics, top risks, and asks (decisions or resources needed). **Board reports** are high-level: strategic risk, compliance posture, major incidents or audits, and trend. Tailor detail to the audience; put the main message first; use visuals where they clarify.\n\n## How to build a one-pager\n\n1. **Header**: Period, report owner, status (e.g. RAG).\n2. **Summary**: 2–3 sentences — overall posture and main message.\n3. **Metrics**: 3–5 numbers (e.g. open critical risks, open findings, certifications).\n4. **Top risks / issues**: 3–5 bullets with owner and due date where relevant.\n5. **Asks**: What decisions or resources are needed?\n6. **Appendix** (optional): Detail for those who want to dig in.\n\n## In practice\n\nWhen the board asks for a one-pager, they rarely want 10 pages. Lead with *We are green/amber/red because…* and *We need your decision on X.* Back it up with a few numbers. If something is red, say what is being done and what help is needed. That structure works for most risk and compliance reports.\n\n## Accountability\n\nReporting creates accountability: when leadership sees open risks or audit findings, they can prioritise and hold owners to account. Regular reporting (e.g. monthly or quarterly) keeps risk and compliance visible and supports a culture of continuous improvement.\n\n## Key takeaway\n\nReport risk and compliance with clear metrics and structure. Tailor reports to the audience; use reporting to drive accountability and decisions.\n\n## Exam alignment\n\nISC² SSCP (Reporting; security operations).', 28, 3);

-- ========== BH-SPEC-IAM: MODULES ==========
INSERT INTO public.modules (id, course_id, title, description, order_index) VALUES
  ('d0000000-0000-4000-8000-000000000011', 'a0000000-0000-4000-8000-000000000009', 'IAM Fundamentals', 'Identity, authentication, authorization, and directory services.', 1),
  ('d0000000-0000-4000-8000-000000000012', 'a0000000-0000-4000-8000-000000000009', 'Access Control Models and Mechanisms', 'DAC, MAC, RBAC, ABAC, MFA, and privileged access.', 2),
  ('d0000000-0000-4000-8000-000000000013', 'a0000000-0000-4000-8000-000000000009', 'Identity Lifecycle and Federation', 'Provisioning, deprovisioning, SSO, and federation.', 3),
  ('d0000000-0000-4000-8000-000000000014', 'a0000000-0000-4000-8000-000000000009', 'IAM in Practice', 'Zero trust, cloud IAM, monitoring, and incident response.', 4);

-- ========== BH-SPEC-IAM: LESSONS (Module 1) ==========
INSERT INTO public.lessons (id, module_id, title, description, content_markdown, duration_minutes, order_index) VALUES
  ('e0000000-0000-4000-8000-000000000011', 'd0000000-0000-4000-8000-000000000011', 'Identity, Authentication, and Authorization', 'Core IAM concepts defined.', E'# Identity, Authentication, and Authorization\n\n## Introduction\n\nThis lesson defines identity, authentication, and authorization and how they work together. You will learn the difference between "who you are", "proving it", and "what you can do", with examples you can apply in enterprise systems.\n\n## Objectives\n\nBy the end of this lesson you will be able to:\n\n- Define identity, authentication, and authorization.\n- Explain how they work together in access decisions.\n- Give examples of each in enterprise systems.\n\n## Identity\n\n**Identity** is the set of attributes that describe an entity (person, system, or service) in a way that can be used for access and accountability. In enterprises, identities are often represented in a directory (e.g. Active Directory, LDAP) with attributes such as name, email, role, and group membership. Identities can be for humans (user accounts) or machines (service accounts, API credentials). Strong identity management ensures each entity has one consistent identity and that it is accurate and up to date.\n\n**Example:** Jane Smith has an identity in the corporate directory: username *jsmith*, email *jane.smith@company.com*, department *Finance*, role *Finance-User*. The payroll application uses this identity to know *who* is logging in and to apply the right access (authorization). A backup service has a *service account* identity (e.g. *svc-backup*) so its actions are auditable.\n\n## Authentication\n\n**Authentication** is the process of verifying that an entity is who or what it claims to be. It answers: "Are you really this identity?" Methods include something you know (password), something you have (token, smart card), and something you are (biometrics). Multi-factor authentication (MFA) combines two or more factors to reduce the risk of credential theft. Authentication typically happens at login; session management and re-authentication protect against session hijacking.\n\n| Factor | Example | Strength |\n|--------|--------|----------|\n| Something you know | Password, PIN | Can be stolen or guessed |\n| Something you have | Phone, token, smart card | Theft required |\n| Something you are | Fingerprint, face | Hard to replicate |\n\n**Example:** When Jane logs in, she enters her password (something she knows) and a code from her authenticator app (something she has). The system authenticates her as *jsmith* before checking what she is allowed to do.\n\n## Authorization\n\n**Authorization** is the process of determining what an authenticated identity is allowed to do. It answers: "Given who you are, what resources and actions are you permitted?" Authorization is enforced by access control mechanisms (e.g. permissions, roles, policies) and is checked each time a resource is accessed. It is distinct from authentication: you must first prove who you are, then the system decides what you can access.\n\n**Example:** After Jane is authenticated, the payroll app checks her role: *Finance-User* can view payslips and update her own profile but cannot approve payments. The *Finance-Approver* role can approve; the system denies Jane that action because her identity is not in that role.\n\n## How they work together\n\n1. **Identity** — The system has a record of who you are (attributes, roles).\n2. **Authentication** — You prove you are that identity (e.g. password + MFA).\n3. **Authorization** — The system allows or denies each action based on your identity and policy.\n\n**In practice:** If someone steals Jane''s password but not her phone, they fail at step 2 (no MFA). If they steal both, they pass 1 and 2 but are still limited by step 3 (what *jsmith* is allowed to do). Defence in depth means strong authentication and least-privilege authorization.\n\n## Key takeaway\n\nIdentity is who you are; authentication proves it; authorization decides what you can do. All three are needed for secure access.\n\n## Exam alignment\n\nCISSP (Identity and Access Management).', 32, 1),
  ('e0000000-0000-4000-8000-000000000012', 'd0000000-0000-4000-8000-000000000011', 'Directory Services and Identity Stores', 'How directories store and expose identity data.', E'# Directory Services and Identity Stores\n\n## Introduction\n\nThis lesson covers how directory services and identity stores hold and expose identity and group data. You will learn the role of directories in authentication and authorization and how to secure them.\n\n## Objectives\n\nBy the end of this lesson you will be able to:\n\n- Describe what a directory service is and common protocols (LDAP, AD).\n- Explain how applications use directories for authentication and lookup.\n- List security considerations for directory design and access.\n\n## Directory services\n\nA **directory** is a specialised database optimised for read-heavy, hierarchical data such as users, groups, and attributes. **LDAP** (Lightweight Directory Access Protocol) is a standard protocol for querying and updating directories. **Active Directory (AD)** is Microsoft''s directory and identity platform; it integrates with Kerberos for authentication and Group Policy for configuration. Directories are central to enterprise IAM: they are the source of truth for identity and group membership.\n\n| Component | Purpose |\n|-----------|--------|\n| **Directory** | Stores users, groups, attributes (hierarchical, read-optimised) |\n| **LDAP** | Protocol to query/update directory data |\n| **AD** | Microsoft directory + Kerberos auth + Group Policy |\n\n**Example:** An application needs to check if *jsmith* is in the group *Finance-Approvers*. It issues an LDAP query to the directory: *Is user jsmith member of group Finance-Approvers?* The directory returns yes or no; the application uses that for authorization.\n\n## Identity stores\n\n**Identity stores** hold credentials (e.g. password hashes) and attributes. They may be part of the directory (e.g. AD) or separate (e.g. a dedicated identity provider). Applications may authenticate against the directory directly or through an intermediary (e.g. federation, SSO). Replication and redundancy are important for availability; backup and recovery procedures must protect directory data.\n\n**How applications use them:** (1) **Authentication** — User submits credentials; app (or IdP) checks them against the identity store (e.g. compare password hash). (2) **Lookup** — App looks up user attributes or group membership to decide access (authorization). (3) **Sync** — Some systems sync a copy of users/groups from the directory for performance or offline use; keep sync secure and timely.\n\n## Security considerations\n\nProtect the directory as a high-value asset: restrict who can read and modify it; use strong authentication for admin access; encrypt data in transit and at rest; monitor for anomalous queries or changes. Compromise of the directory can lead to broad access loss or privilege escalation.\n\n**In practice:** Limit admin rights to the directory; use dedicated admin accounts and MFA. Encrypt LDAP (e.g. LDAPS). Monitor for: bulk exports of user data, new admin accounts, changes to sensitive groups (e.g. Domain Admins). Have a recovery plan: backup and test restore; know how to revoke and rebuild if compromised.\n\n## Key takeaway\n\nDirectories and identity stores are the backbone of enterprise IAM. Secure them rigorously and understand how applications depend on them.\n\n## Exam alignment\n\nCISSP (Identity and Access Management; directory services).', 30, 2),
  ('e0000000-0000-4000-8000-000000000013', 'd0000000-0000-4000-8000-000000000011', 'Federation and Trust', 'Trust relationships and federated identity.', E'# Federation and Trust\n\n## Introduction\n\nThis lesson introduces federated identity and trust relationships between organisations or domains. You will learn how federation enables single sign-on and secure access across boundaries, and how IdP and SP interact.\n\n## Objectives\n\nBy the end of this lesson you will be able to:\n\n- Define federated identity and when it is used.\n- Explain trust relationships and identity providers vs service providers.\n- Describe protocols and standards used in federation (e.g. SAML, OAuth, OIDC).\n\n## Federated identity\n\n**Federation** allows one organisation to trust another''s authentication. A user authenticates once to their home organisation (identity provider, IdP); the IdP asserts the user''s identity to other applications or organisations (service providers, SPs). This reduces the need for separate accounts and passwords in each system and centralises authentication at the IdP.\n\n**Example:** Your company (IdP) uses Azure AD. A SaaS app (SP) supports "Sign in with your work account." When you click that, you are redirected to Azure AD to sign in; Azure AD then tells the SaaS app *this is jsmith from company.com*. The app trusts Azure AD and grants access without storing your password.\n\n## Identity provider and service provider\n\nThe **identity provider (IdP)** authenticates the user and issues an assertion or token. The **service provider (SP)** (or relying party) receives the assertion and grants access based on it. Trust is established through metadata exchange, certificates, and agreements. The SP trusts the IdP to authenticate correctly and to release only appropriate attributes.\n\n| Role | Responsibility |\n|------|----------------|\n| **IdP** | Authenticate user; issue assertion/token with identity and attributes |\n| **SP** | Accept assertion/token; grant access based on identity and policy |\n\n## Protocols\n\n**SAML** (Security Assertion Markup Language) is used in many enterprise and government federations; it uses XML assertions. **OAuth 2.0** is a framework for authorization (delegated access to resources); it is often used with **OpenID Connect (OIDC)** for authentication. OIDC adds an identity layer on top of OAuth. Choose protocol based on ecosystem (e.g. web vs mobile, enterprise vs consumer) and integration requirements.\n\n| Protocol | Typical use |\n|----------|-------------|\n| **SAML** | Enterprise SSO; government; many legacy apps |\n| **OAuth 2.0** | Delegated access (e.g. "allow this app to read my calendar") |\n| **OIDC** | Authentication on top of OAuth; modern web and mobile |\n\n## In practice\n\nWhen you add a new cloud app, you often "configure SSO": you give the app your IdP metadata (or vice versa) and map attributes (e.g. email, role). The app becomes an SP. From then on, users sign in via the IdP and the app trusts the IdP''s assertion. Keeping IdP secure (MFA, monitoring) protects all connected SPs.\n\n## Key takeaway\n\nFederation lets one organisation trust another''s authentication. IdPs and SPs work together via SAML, OAuth, or OIDC to enable single sign-on and secure cross-boundary access.\n\n## Exam alignment\n\nCISSP (Identity and Access Management; federation).', 30, 3);

-- ========== BH-SPEC-IAM: LESSONS (Module 2) ==========
INSERT INTO public.lessons (id, module_id, title, description, content_markdown, duration_minutes, order_index) VALUES
  ('e0000000-0000-4000-8000-000000000014', 'd0000000-0000-4000-8000-000000000012', 'Access Control Models', 'DAC, MAC, RBAC, ABAC.', E'# Access Control Models\n\n## Introduction\n\nThis lesson covers the main access control models: discretionary, mandatory, role-based, and attribute-based. You will learn when each is used, how they differ, and how to design one role that follows least privilege.\n\n## Objectives\n\nBy the end of this lesson you will be able to:\n\n- Define DAC, MAC, RBAC, and ABAC.\n- Compare their strengths and typical use cases.\n- Explain how role-based access is designed and maintained.\n\n## Discretionary Access Control (DAC)\n\nIn **DAC**, the owner of a resource decides who can access it. Permissions are granted to users or groups at the discretion of the resource owner. DAC is flexible and common in file systems and collaboration tools, but it can lead to inconsistent permissions and is harder to enforce central policy. Users may over-share or forget to revoke access.\n\n**Example:** In a file share, Alice owns *ProjectX*. She grants Bob read and Carol read/write. She can revoke Bob later. The system enforces what Alice decided; there is no central policy that overrides her.\n\n## Mandatory Access Control (MAC)\n\nIn **MAC**, the system enforces access based on labels (e.g. classification levels) assigned to subjects and objects. Users cannot override the policy; only authorised processes can change labels. MAC is used in high-security and government environments where data classification must be strictly enforced. It is less flexible than DAC but provides strong consistency.\n\n**Example:** A document is labelled *Secret*; a user has clearance *Secret*. The system allows access. Another user has only *Confidential* clearance; the system denies access to *Secret* data regardless of who owns it.\n\n## Role-Based Access Control (RBAC)\n\nIn **RBAC**, access is granted through **roles**. Users are assigned roles; roles are assigned permissions. This simplifies administration: add or remove a role from a user instead of managing many permissions. Roles should reflect job function. Design roles to follow least privilege and avoid role explosion (too many roles). RBAC is widely used in enterprises and applications.\n\n| Model | Who/what decides access | Typical use |\n|-------|-------------------------|-------------|\n| **DAC** | Resource owner | File shares; collaboration |\n| **MAC** | System (labels) | Government; classified |\n| **RBAC** | Roles (admin-assigned) | Enterprise apps; ERP |\n| **ABAC** | Attributes + rules | Cloud; dynamic context |\n\n**How to design one RBAC role:** (1) Name the role after job function (e.g. *Finance-Approver*). (2) List the minimum permissions needed for that function. (3) Assign the role to users who have that function. (4) Do not add permissions "just in case"; use a separate role or JIT if needed. (5) Review periodically and remove unused permissions.\n\n## Attribute-Based Access Control (ABAC)\n\nIn **ABAC**, access is determined by **attributes** of the user, resource, action, and environment (e.g. time, location, device). Policies are expressed as rules over attributes (e.g. "Allow if user.department == resource.owner and time in business hours"). ABAC is flexible and can support fine-grained and context-aware decisions; it can be more complex to implement and manage. It is used in dynamic or cloud environments.\n\n**Example:** *Allow read access to document if user.department == document.owner AND request from managed device AND time is 08:00–18:00.* The same user might be allowed at 10:00 from the office and denied at 22:00 from home, depending on policy.\n\n## Key takeaway\n\nDAC is owner-driven; MAC is label-driven; RBAC is role-driven; ABAC is attribute-driven. Choose the model that fits your security and operational needs.\n\n## Exam alignment\n\nCISSP (Identity and Access Management; access control models).', 35, 1),
  ('e0000000-0000-4000-8000-000000000015', 'd0000000-0000-4000-8000-000000000012', 'Multi-Factor and Strong Authentication', 'MFA, passwordless, and phishing-resistant methods.', E'# Multi-Factor and Strong Authentication\n\n## Introduction\n\nThis lesson covers multi-factor authentication and stronger methods that resist phishing and credential theft. You will learn how to design and deploy MFA and when to use passwordless or hardware-backed methods.\n\n## Objectives\n\nBy the end of this lesson you will be able to:\n\n- Explain the three factors of authentication and why MFA reduces risk.\n- Describe MFA methods: SMS, app, token, FIDO.\n- Recommend MFA and passwordless options for different use cases.\n\n## Factors of authentication\n\n**Something you know** — Passwords, PINs. Weak alone because they can be stolen or guessed. **Something you have** — Phone, hardware token, smart card. **Something you are** — Biometrics (fingerprint, face). MFA requires two or more factors from different categories. Even if a password is stolen, an attacker without the second factor is blocked (unless they phish the second factor too).\n\n| Method | Factor | Phishing-resistant? | Typical use |\n|--------|--------|----------------------|-------------|\n| SMS / voice | Have | No (SIM swap, relay) | General (better than password only) |\n| Authenticator app (TOTP) | Have | Partially | General; better than SMS |\n| Push approval | Have | Partially | General |\n| Hardware token (FIDO) | Have | Yes | High-privilege; sensitive |\n| FIDO2/WebAuthn | Have / are | Yes | Passwordless; admins |\n\n**Example:** For a standard user, TOTP app is a good balance of security and usability. For a domain admin, require FIDO or hardware token so a phishing site cannot steal the second factor.\n\n## Passwordless and phishing-resistant\n\n**Passwordless** authentication removes the password and uses other factors (e.g. FIDO, biometrics). It reduces password-related risk and improves usability. **Phishing-resistant** MFA cannot be easily tricked by a fake site (e.g. FIDO). Use phishing-resistant MFA for administrators and sensitive access.\n\n**How to choose:** (1) **All users** — At least MFA (prefer app over SMS). (2) **Privileged / high-risk** — Phishing-resistant (FIDO or hardware). (3) **Passwordless** — Where supported, FIDO or biometrics for better UX and security. (4) **Avoid** — SMS as sole second factor for sensitive or admin access.\n\n## In practice\n\nWhen rolling out MFA, start with high-privilege and high-risk accounts, then expand. Communicate why (e.g. "Protect your account and company data"). Have a recovery process (e.g. help desk can reset MFA with verification). Monitor for MFA fatigue (repeated push notifications used in attacks) and consider number matching or restrict push-only where needed.\n\n## Key takeaway\n\nMFA significantly reduces risk; use multiple factors from different categories. Prefer FIDO or hardware tokens for high-privilege and phishing-resistant scenarios.\n\n## Exam alignment\n\nCISSP (Identity and Access Management; authentication).', 32, 2),
  ('e0000000-0000-4000-8000-000000000016', 'd0000000-0000-4000-8000-000000000012', 'Privileged Access Management', 'Managing and securing privileged accounts.', E'# Privileged Access Management\n\n## Introduction\n\nThis lesson covers privileged access management (PAM): who has admin rights, how they are controlled, and how to monitor and protect privileged accounts. You will learn PAM practices and how to apply JIT and vaulting in practice.\n\n## Objectives\n\nBy the end of this lesson you will be able to:\n\n- Define privileged access and why it needs special control.\n- Describe just-in-time and just-enough privilege.\n- Explain vaulting, session management, and monitoring for privileged access.\n\n## Why privileged access matters\n\n**Privileged accounts** (administrators, service accounts, root) can change configuration, access sensitive data, and create or delete accounts. Compromise of a privileged account can lead to full system or domain compromise. Privileged access should be minimised, controlled, and monitored.\n\n**Example:** A domain admin account can reset any user''s password, create new admins, and access all domain-joined systems. If an attacker steals that account, they effectively own the domain. PAM aims to make that harder (fewer standing admins, vaulted credentials) and to detect and respond if it happens (session monitoring, alerts).\n\n## Just-in-time and just-enough\n\n**Just-in-time (JIT)** access grants privilege only when needed and for a limited time, instead of standing access. **Just-enough privilege (JEP)** grants the minimum permission required for the task. Both reduce the attack surface and the window of abuse. Implement via approval workflows, time-bound access, and role design.\n\n| Practice | What it does | Benefit |\n|----------|--------------|--------|\n| **JIT** | Grant admin (or role) only for a short window when needed | No standing privilege to steal |\n| **JEP** | Grant only the permission needed (e.g. reset password, not full admin) | Limits blast radius |\n| **Vaulting** | Credentials in vault; user checks out for session | No shared password; audit trail |\n| **Session monitoring** | Record and alert on privileged sessions | Detect abuse; investigate |\n\n**How to implement JIT for one system:** (1) Remove standing admin rights from daily accounts. (2) Require request (ticket or portal) with reason and approval. (3) Grant time-bound access (e.g. 4 hours) to a specific role or system. (4) Revoke automatically when the window ends. (5) Log who had access and when.\n\n## Vaulting and session management\n\n**Credential vaulting** stores privileged credentials in a secure store; users request release for a session rather than knowing the password. **Session management** records and can terminate privileged sessions; session recording supports audit and investigation. **Monitoring** detects anomalous use of privileged accounts (e.g. access at unusual times, bulk data access).\n\n**In practice:** When an admin needs to log on to a server, they connect via the PAM tool; the tool checks out the credential from the vault, starts a recorded session, and rotates the password after the session. The admin never sees the password; all access is logged. If something goes wrong, you have a recording and know who had access.\n\n## Key takeaway\n\nPrivileged access must be minimised (JIT, JEP), controlled (vaulting, approval), and monitored (sessions, behaviour). PAM reduces the risk of abuse and compromise.\n\n## Exam alignment\n\nCISSP (Identity and Access Management; privileged access).', 32, 3);

-- ========== BH-SPEC-IAM: LESSONS (Module 3) ==========
INSERT INTO public.lessons (id, module_id, title, description, content_markdown, duration_minutes, order_index) VALUES
  ('e0000000-0000-4000-8000-000000000017', 'd0000000-0000-4000-8000-000000000013', 'Identity Lifecycle', 'Provisioning, changes, and deprovisioning.', E'# Identity Lifecycle\n\n## Introduction\n\nThis lesson covers the identity lifecycle from onboarding (provisioning) through changes (transfers, role changes) to offboarding (deprovisioning). You will learn how to keep access accurate and timely and how to run one deprovisioning checklist.\n\n## Objectives\n\nBy the end of this lesson you will be able to:\n\n- Describe the stages of the identity lifecycle.\n- Explain provisioning and deprovisioning processes and automation.\n- Address common gaps (orphaned accounts, delayed revocation).\n\n## Provisioning\n\n**Provisioning** is granting access when a user joins or when their role requires new access. It should be driven by HR or manager request and follow approval. Best practice: automate from a source of truth (e.g. HR system) so new hires get default access and role changes trigger access updates. This reduces manual error and delay.\n\n**Example:** When HR marks *Jane Smith* as hired in the HR system, an automated workflow creates her directory account, adds her to *All-Employees* and *Finance-User*, and provisions access to email and core apps. Her manager can request additional access (e.g. *Finance-Approver*) through an approval workflow. Without automation, provisioning might take days and be inconsistent.\n\n## Mid-lifecycle changes\n\nWhen a user changes role or department, access should be updated: add access for the new role, remove access that is no longer needed. When projects end or contracts expire, remove project-specific access. Regular access reviews (recertification) catch drift: managers confirm who still needs what.\n\n| Stage | Action |\n|-------|--------|\n| **Join** | Provision default access from HR/manager; approve exceptions |\n| **Role change** | Add new role access; remove old role access |\n| **Project end** | Remove project-specific access |\n| **Leave** | Deprovision all access same day |\n\n## Deprovisioning\n\n**Deprovisioning** is revoking access when a user leaves or when access is no longer needed. It should happen as soon as possible (same day for leavers). Revoke all access: accounts, group membership, federation, application access. Disable or delete accounts; for shared or service accounts, change credentials. Delayed deprovisioning is a major cause of insider and ex-employee risk.\n\n**Deprovisioning checklist (one leaver):** (1) Disable directory account (or trigger from HR). (2) Remove from all groups. (3) Revoke SSO/federation sessions. (4) Disable or revoke access in each application (or via IdP if SSO). (5) Reassign or revoke shared mailboxes and delegates. (6) For service accounts they owned, change password and document new owner. (7) Log and retain for audit.\n\n## In practice\n\nMany incidents start with "they left last month but still had access." Tie deprovisioning to HR offboarding: when HR marks someone as terminated, that event triggers the checklist (manual or automated). If you cannot automate fully, at least disable the directory account and SSO immediately so app access stops. Fill in application-level revocation as soon as possible.\n\n## Key takeaway\n\nManage the full lifecycle: provision from a trusted source, update on role change, deprovision immediately on exit. Automate and review to keep access accurate.\n\n## Exam alignment\n\nCISSP (Identity and Access Management; lifecycle).', 30, 1),
  ('e0000000-0000-4000-8000-000000000018', 'd0000000-0000-4000-8000-000000000013', 'Single Sign-On and Access Aggregation', 'SSO design and security.', E'# Single Sign-On and Access Aggregation\n\n## Introduction\n\nThis lesson covers single sign-on (SSO): how it works, benefits, and security considerations. You will learn how SSO reduces password fatigue and improves control while introducing central points to protect.\n\n## Objectives\n\nBy the end of this lesson you will be able to:\n\n- Explain how SSO works and the role of the identity provider.\n- Describe benefits (usability, centralised control) and risks (single point of failure).\n- Secure SSO: MFA, session policy, and monitoring.\n\n## How SSO works\n\nWith **SSO**, the user signs in once to the identity provider; the IdP then asserts the user to multiple applications without asking for a password again. The user gets a better experience and the organisation can enforce one strong authentication (e.g. MFA) at the IdP for all apps. SSO can be implemented with federation (SAML, OIDC) or with a central IdP that applications trust.\n\n**Example:** User opens App A → redirected to IdP → signs in with password + MFA → IdP sends token to App A → access granted. User then opens App B → App B sees valid session (or gets token from IdP) → access granted without another login. One login, many apps.\n\n## Benefits and risks\n\n| Benefits | Risks |\n|----------|-------|\n| Fewer passwords; less fatigue | IdP is single point of failure |\n| One place to enforce MFA | Compromise of IdP affects all apps |\n| Centralised access policy | Session/token theft can grant broad access |\n| Easier offboarding (disable at IdP) | |\n\nMitigate with strong IdP security (MFA, hardening), session timeouts, and monitoring for anomalous logins.\n\n## Session and token security\n\nControl session lifetime and re-authentication for sensitive actions. Use short-lived tokens where possible; validate tokens and bind them to device or IP if appropriate. Monitor for token theft or replay (e.g. same token used from two locations).\n\n**How to harden SSO:** (1) Enforce MFA at the IdP for all users. (2) Set session timeout (e.g. 8 hours inactivity; shorter for sensitive apps). (3) Require re-authentication for high-risk actions (e.g. change password, access admin app). (4) Monitor for impossible travel, new device, bulk logins. (5) Have a plan to revoke all sessions (e.g. password reset, disable account) if compromise is suspected.\n\n## In practice\n\nWhen you onboard a new SaaS app, prefer "SSO with our IdP" over "username and password in the app." That way one disable at the IdP removes access to that app too, and you have one place to enforce MFA. Document which apps use SSO and which still have local accounts so you know what to revoke on offboarding.\n\n## Key takeaway\n\nSSO improves usability and centralises control but makes the IdP critical. Secure the IdP, enforce MFA, and manage sessions and tokens carefully.\n\n## Exam alignment\n\nCISSP (Identity and Access Management; SSO).', 28, 2),
  ('e0000000-0000-4000-8000-000000000019', 'd0000000-0000-4000-8000-000000000013', 'Federation in Practice', 'Designing and operating federated identity.', E'# Federation in Practice\n\n## Introduction\n\nThis lesson covers practical aspects of designing and operating federated identity: trust setup, attribute release, and common issues. You will learn how to implement federation securely and troubleshoot common failures.\n\n## Objectives\n\nBy the end of this lesson you will be able to:\n\n- Describe how to establish trust between IdP and SP (metadata, certs).\n- Explain attribute release and privacy (release only what is needed).\n- Troubleshoot common federation issues (expired certs, misconfiguration).\n\n## Establishing trust\n\nTrust is established by exchanging metadata (endpoints, certificates) and agreeing on identifiers and attributes. Use secure channels for metadata; validate SP requests (e.g. correct redirect URIs). Certificates must be valid and renewed; expired certs are a common cause of federation failures. Document trust relationships and review them periodically.\n\n**Steps to add a new SP:** (1) Obtain SP metadata (URL or file) over a secure channel. (2) Load metadata into IdP (or vice versa); verify entity ID and endpoints. (3) Configure attribute release: which attributes (e.g. email, name, role) the SP needs. (4) Test: trigger SSO from SP, confirm login and attributes. (5) Document the trust (SP name, purpose, attributes released) and set a cert renewal reminder.\n\n## Attribute release\n\nThe IdP releases attributes (e.g. email, role) to the SP. Apply **minimal release**: only send attributes the SP needs. Consider privacy and regulation (e.g. data minimisation). Use contracts or policies to define what can be released and to whom.\n\n**Example:** The SP needs email (for user identity) and department (for access rules). Do not release employee ID or phone unless the SP has a defined need. If the SP is in another jurisdiction, check data transfer and privacy requirements.\n\n## Operations and troubleshooting\n\n| Issue | Typical cause | Action |\n|-------|----------------|--------|\n| "Certificate expired" or "Invalid signature" | IdP or SP cert expired | Renew cert; update metadata; test |\n| "User not found" or "No attributes" | Attribute not released or wrong name | Check IdP attribute release; match SP expected claim names |\n| "Redirect URI mismatch" | SP configured wrong URL | Fix redirect URI in SP config to match IdP metadata |\n| Intermittent failures | Clock skew; session timeout | Sync time (NTP); check session and token lifetime |\n\nMonitor federation for errors (failed logins, misconfigurations). Use logging and analytics to detect abuse (e.g. token replay, unusual patterns). Plan for IdP outage: have a fallback or communicate downtime. Test after changes (cert rotation, attribute changes).\n\n## Key takeaway\n\nFederation in practice requires secure trust setup, minimal attribute release, and solid operations (monitoring, cert management, testing).\n\n## Exam alignment\n\nCISSP (Identity and Access Management; federation).', 28, 3);

-- ========== BH-SPEC-IAM: LESSONS (Module 4) ==========
INSERT INTO public.lessons (id, module_id, title, description, content_markdown, duration_minutes, order_index) VALUES
  ('e0000000-0000-4000-8000-00000000001a', 'd0000000-0000-4000-8000-000000000014', 'IAM in Zero Trust', 'Identity as the perimeter.', E'# IAM in Zero Trust\n\n## Introduction\n\nThis lesson covers how identity and access fit into a zero trust architecture. You will learn how zero trust uses identity, device, and context to make access decisions and how IAM supports it.\n\n## Objectives\n\nBy the end of this lesson you will be able to:\n\n- Explain how zero trust changes the role of identity and access.\n- Describe continuous verification and least privilege in zero trust.\n- List IAM capabilities needed for zero trust (identity, device, policy).\n\n## Zero trust and identity\n\n**Zero trust** assumes no implicit trust based on network location. Every access request is verified. Identity is central: who is requesting, from what device, in what context (time, location, sensitivity of resource). IAM provides the identity signal and enforces policy (allow/deny, step-up MFA) at each request.\n\n**Example:** In a traditional model, being on the corporate network might grant access to internal apps. In zero trust, even on the corporate network the user must authenticate and the system checks identity, device (e.g. managed, patched), and context (e.g. app sensitivity). Access is granted per request, not by location.\n\n## Continuous verification\n\nAccess is not "grant once at login" but verified continuously. Session validity, device posture (e.g. patch level, encryption), and behaviour can trigger re-authentication or revocation. IAM and conditional access policies implement this: e.g. require MFA for sensitive apps, block access from unmanaged devices.\n\n| Traditional | Zero trust |\n|-------------|------------|\n| Trust by network (e.g. VPN = access) | Verify every request |\n| Login once; session may be long | Re-verify; short sessions; device/posture checks |\n| Broad access by role | Least privilege; per-resource or per-request |\n\n## Least privilege and micro-segmentation\n\nZero trust applies least privilege: grant only what is needed for the request. IAM supports this with fine-grained permissions, JIT access, and attribute-based policies. Micro-segmentation limits lateral movement; identity and device are used to allow or deny traffic to applications and data.\n\n**IAM capabilities for zero trust:** (1) **Strong identity** — MFA, phishing-resistant where possible; accurate directory. (2) **Device and context** — Integrate with device management (MDM) for posture; use signals (location, risk). (3) **Policy engine** — Conditional access: allow/block/step-up based on identity + device + context. (4) **Least privilege** — Roles and permissions that are minimal; JIT for elevated access. (5) **Monitoring** — Log and analyse access; detect anomalies and revoke when needed.\n\n## Key takeaway\n\nIn zero trust, identity is the primary control. IAM must support continuous verification, least privilege, and integration with device and context for every access decision.\n\n## Exam alignment\n\nCISSP (Identity and Access Management; zero trust).', 30, 1),
  ('e0000000-0000-4000-8000-00000000001b', 'd0000000-0000-4000-8000-000000000014', 'Cloud and Hybrid IAM', 'Identity across cloud and on-premises.', E'# Cloud and Hybrid IAM\n\n## Introduction\n\nThis lesson covers IAM in cloud and hybrid environments: cloud identity services, hybrid identity, and how to manage access consistently across on-premises and cloud.\n\n## Objectives\n\nBy the end of this lesson you will be able to:\n\n- Describe cloud identity services (e.g. Azure AD, AWS IAM) and how they differ from on-prem directories.\n- Explain hybrid identity (sync, federation) and when to use each.\n- Manage identities and access across cloud and on-premises.\n\n## Cloud identity services\n\nCloud providers offer their own identity and access services: **Azure Active Directory** (Azure AD / Entra ID) for Microsoft 365 and Azure; **AWS IAM** for AWS resources; **Google Cloud IAM** for GCP. They support users, groups, roles, and policies. They may sync with on-prem directories or act as the primary identity store for cloud-only users.\n\n| Provider | Identity service | Typical use |\n|---------|------------------|-------------|\n| Microsoft | Azure AD / Entra ID | M365, Azure; hybrid with AD |\n| AWS | IAM (users, roles, policies) | AWS resources; no directory for humans (often use federation) |\n| GCP | Cloud IAM | GCP resources; can integrate with AD or Google Workspace |\n\n**Example:** In AWS, human users often authenticate via federation (e.g. Azure AD or corporate IdP); AWS then assigns IAM roles based on identity. For workloads, use IAM roles (assumed by EC2, Lambda, etc.) instead of long-lived keys.\n\n## Hybrid identity\n\n**Hybrid identity** connects on-premises directories with cloud. Options: **sync** (replicate users and groups to the cloud; may include password hash sync for seamless auth); **federation** (on-prem IdP authenticates; cloud trusts the IdP). Choose based on existing investment, compliance, and whether you need cloud-only users.\n\n| Approach | How it works | When to use |\n|----------|--------------|-------------|\n| **Sync** | Users/groups copied to cloud; optional password hash | Same identity in cloud; simpler; cloud can auth directly |\n| **Federation** | Cloud redirects to on-prem IdP; no passwords in cloud | Stricter control; compliance (no password in cloud) |\n\n## Consistency and least privilege\n\nApply the same principles in the cloud: least privilege, MFA, lifecycle management. Cloud IAM is often more granular (resource-level policies); use it to limit access to specific resources. Monitor cloud identity for misconfigurations and anomalous access.\n\n**In practice:** Use one identity for both on-prem and cloud where possible (hybrid) so offboarding and access reviews apply everywhere. For cloud-native resources (e.g. S3, Azure storage), use roles and resource-level policies so a compromised account cannot access all data. Review cloud IAM quarterly (roles, keys, unused permissions).\n\n## Key takeaway\n\nCloud and hybrid IAM require understanding cloud identity services and how they integrate with on-prem. Apply consistent policies and least privilege across environments.\n\n## Exam alignment\n\nCISSP (Identity and Access Management; cloud IAM).', 32, 2),
  ('e0000000-0000-4000-8000-00000000001c', 'd0000000-0000-4000-8000-000000000014', 'IAM Monitoring and Incident Response', 'Detecting and responding to identity threats.', E'# IAM Monitoring and Incident Response\n\n## Introduction\n\nThis lesson covers how to monitor identity and access for threats and how to respond to identity-related incidents. You will learn what to log, what to detect, and how to contain and recover.\n\n## Objectives\n\nBy the end of this lesson you will be able to:\n\n- List key IAM events to log and monitor (logins, permission changes, failures).\n- Describe indicators of identity compromise or abuse.\n- Outline response steps for credential compromise and privilege abuse.\n\n## What to monitor\n\nLog and monitor: **authentication** — successful and failed logins, MFA events, password changes; **authorization** — permission changes, role assignments, access to sensitive resources; **lifecycle** — provisioning, deprovisioning, account lockouts. Correlate with other signals (e.g. impossible travel, access from new device).\n\n| Category | Examples | Why |\n|----------|----------|-----|\n| **Auth** | Failed logins, MFA bypass, password reset | Credential stuffing; account takeover |\n| **Authz** | Role/permission change, sensitive resource access | Privilege escalation; data access |\n| **Lifecycle** | New admin, account disabled, bulk export | Misuse; offboarding gaps |\n\n## Indicators of compromise\n\nSigns of compromise or abuse: many failed logins then success; login from unusual location or device; privilege escalation; access to data or systems outside normal pattern; service account used interactively; dormant account suddenly active. Use analytics and UEBA (user and entity behaviour analytics) to surface anomalies.\n\n**Example scenario:** 50 failed logins for *jsmith* from an unknown IP, then one success. Then *jsmith* adds themselves to the *Finance-Approvers* group. That sequence suggests credential compromise followed by privilege escalation. Alert on both and investigate.\n\n## Response\n\n**Credential compromise:** (1) Disable or lock the account (or force password reset). (2) Revoke sessions and tokens so the attacker loses access. (3) Force MFA re-enrollment if MFA was bypassed. (4) Check for lateral movement (other logins from same IP; new accounts created; permission changes). (5) Preserve logs for investigation. (6) Notify user and help desk; restore access securely after verification.\n\n**Privilege abuse:** Revoke excessive access; investigate what was accessed or changed; involve HR or legal if insider. Document and improve detection and controls.\n\n## In practice\n\nHave playbooks for "suspected credential compromise" and "privilege escalation detected." The first steps (disable account, revoke sessions) should be doable quickly; then hand off to incident response for full investigation. Integrate IAM logs with your SIEM or security platform so one alert can trigger the right response.\n\n## Key takeaway\n\nMonitor IAM events and behaviour; detect anomalies and known attack patterns. Respond to credential compromise and abuse by revoking access, investigating, and improving controls.\n\n## Exam alignment\n\nCISSP (Identity and Access Management; monitoring and response).', 30, 3);

-- ========== BH-SPEC-CLOUD: MODULES ==========
INSERT INTO public.modules (id, course_id, title, description, order_index) VALUES
  ('d0000000-0000-4000-8000-000000000021', 'a0000000-0000-4000-8000-00000000000a', 'Cloud Security Fundamentals', 'Shared responsibility, cloud models, and threats.', 1),
  ('d0000000-0000-4000-8000-000000000022', 'a0000000-0000-4000-8000-00000000000a', 'Cloud Identity and Access', 'IAM in cloud, roles, policies, conditional access.', 2),
  ('d0000000-0000-4000-8000-000000000023', 'a0000000-0000-4000-8000-00000000000a', 'Cloud Infrastructure and Network Security', 'VPC, encryption, logging, and hardening.', 3),
  ('d0000000-0000-4000-8000-000000000024', 'a0000000-0000-4000-8000-00000000000a', 'Cloud Security Operations', 'CSPM, incident response, and compliance in cloud.', 4);

-- ========== BH-SPEC-CLOUD: LESSONS (Module 1) ==========
INSERT INTO public.lessons (id, module_id, title, description, content_markdown, duration_minutes, order_index) VALUES
  ('e0000000-0000-4000-8000-000000000021', 'd0000000-0000-4000-8000-000000000021', 'Shared Responsibility Model', 'Who secures what in the cloud.', E'# Shared Responsibility Model\n\n## Introduction\n\nThis lesson explains the shared responsibility model: what the cloud provider secures versus what the customer must secure. You will learn how it differs by service type and how to avoid gaps.\n\n## Objectives\n\nBy the end of this lesson you will be able to:\n\n- Explain the shared responsibility model for IaaS, PaaS, and SaaS.\n- List customer responsibilities for each model.\n- Avoid common gaps (e.g. assuming the provider does everything).\n\n## Provider vs customer\n\nThe **cloud provider** is responsible for the security **of** the cloud: physical infrastructure, hypervisor, and managed services. The **customer** is responsible for security **in** the cloud: their data, identity and access, network configuration, and how they use services. The exact split depends on the service: IaaS gives the customer more control and more responsibility; SaaS gives less control and less responsibility for the application layer.\n\n**Example:** For a virtual machine (IaaS), the provider patches the hypervisor and secures the physical datacentre. The customer must patch the OS, configure the firewall, manage access to the VM, and protect data on the disk. If the VM is compromised because the OS was unpatched, that is a customer responsibility.\n\n## IaaS, PaaS, SaaS\n\n| Model | Provider typically secures | Customer typically secures |\n|-------|----------------------------|----------------------------|\n| **IaaS** | Physical, network, hypervisor | OS, apps, data, identity, network config (VPC, firewall) |\n| **PaaS** | + OS, runtime | App, data, identity |\n| **SaaS** | App, platform, runtime | Identity, data classification, usage policy |\n\nAlways read the provider''s shared responsibility documentation; it varies by service and region.\n\n## Avoiding gaps\n\nCommon gaps: leaving default credentials or open storage; misconfiguring network or identity; assuming encryption is automatic. Use checklists and governance (policy, scanning) to ensure customer responsibilities are met. Document your responsibility matrix for each workload.\n\n**In practice:** For each workload, write one table: *Workload X — IaaS VM. Our responsibilities: OS patching, security group rules, IAM for the instance, encryption of attached storage, backup.* Tick each off with a control or tool (e.g. CSPM checks encryption). That prevents "we thought the provider did it."\n\n## Key takeaway\n\nThe shared responsibility model divides security between provider and customer. Know your responsibilities for each service and workload and implement them consistently.\n\n## Exam alignment\n\nAWS Security; Microsoft SC-200 (cloud concepts; shared responsibility).', 30, 1),
  ('e0000000-0000-4000-8000-000000000022', 'd0000000-0000-4000-8000-000000000021', 'Cloud Threats and Attack Vectors', 'Threats specific to cloud environments.', E'# Cloud Threats and Attack Vectors\n\n## Introduction\n\nThis lesson covers threats and attack vectors that are specific to or amplified in cloud environments. You will learn how to identify and mitigate them with concrete controls.\n\n## Objectives\n\nBy the end of this lesson you will be able to:\n\n- List common cloud threats (misconfiguration, credential theft, supply chain).\n- Describe attack vectors (APIs, console, identity).\n- Apply mitigations: hardening, least privilege, monitoring.\n\n## Misconfiguration\n\n**Misconfiguration** is a leading cause of cloud incidents: storage buckets or databases left public; overly permissive IAM policies; unencrypted data; open management ports. Attackers scan for these. Mitigate with configuration baselines, automated checks (CSPM), and least privilege. Use infrastructure as code and peer review for changes.\n\n**Example:** A developer creates an S3 bucket for a project and leaves it publicly readable. A scanner or attacker finds it and exfiltrates data. Mitigation: block public access by default (account policy); CSPM alert on public buckets; require IaC review before deploy.\n\n## Identity and credential theft\n\nCloud identity (console logins, API keys, role assumptions) is a prime target. Stolen credentials can be used to access data, spin up resources, or move laterally. Mitigate with MFA, short-lived credentials, and role-based access with minimal permissions. Rotate keys; avoid long-lived secrets. Monitor for anomalous identity activity.\n\n| Threat | Vector | Mitigation |\n|--------|--------|-------------|\n| Misconfiguration | Public storage; permissive IAM | CSPM; baselines; IaC review |\n| Credential theft | Phishing; leaked keys; compromised VM | MFA; roles instead of keys; rotate; monitor |\n| Supply chain | Malicious image; vulnerable dependency | Image scan; dependency scan; trusted registries |\n\n## Supply chain and third-party\n\n**Supply chain** risk in cloud includes vulnerable or malicious images, libraries, and SaaS integrations. **Third-party** risk includes misconfigured or compromised integrations. Mitigate with image scanning, dependency checks, and strict approval of third-party access. Assume breach and segment; limit blast radius.\n\n**In practice:** Treat "default allow" as the enemy. Default to private, encrypted, and least privilege; require justification for any relaxation. Run CSPM and fix or accept (with approval) every finding. One unchecked misconfiguration can become the breach.\n\n## Key takeaway\n\nCloud threats include misconfiguration, identity theft, and supply chain. Harden configuration, protect identity, and monitor and segment to reduce impact.\n\n## Exam alignment\n\nAWS Security; Microsoft SC-200 (threats; cloud security).', 32, 2),
  ('e0000000-0000-4000-8000-000000000023', 'd0000000-0000-4000-8000-000000000021', 'Cloud Security Posture and Governance', 'Policy, baseline, and continuous assurance.', E'# Cloud Security Posture and Governance\n\n## Introduction\n\nThis lesson covers how to establish and maintain a strong security posture in the cloud through policy, baselines, and continuous assurance. You will learn governance patterns and tools.\n\n## Objectives\n\nBy the end of this lesson you will be able to:\n\n- Define cloud security posture and how it is measured.\n- Use policy and baselines to set expectations (e.g. encryption, networking).\n- Describe CSPM and continuous compliance.\n\n## Security posture\n\n**Security posture** is the overall state of security: how well configuration and controls align with policy and best practice. It is measured by assessing configuration (e.g. are buckets encrypted? Are networks segmented?) and comparing to a baseline. Posture degrades over time as changes are made; continuous assessment is needed.\n\n**Example:** Your policy says "all storage must be encrypted at rest." A CSPM scan finds 3 buckets without encryption. Posture is weak for those resources until they are fixed or explicitly accepted with approval. Posture score might be "85% compliant" until the 3 are remediated.\n\n## Policy and baselines\n\nDefine **policy** for the cloud: what is allowed (e.g. regions, services), what is required (e.g. encryption, logging), and what is forbidden (e.g. public storage). **Baselines** are specific configuration standards (e.g. CIS benchmarks for cloud). Enforce via guardrails (prevent bad config) and detection (find and fix). Use account and organisation structure to apply policy consistently.\n\n| Layer | Example | How to enforce |\n|-------|--------|----------------|\n| **Policy** | "No public buckets" | Organisation policy; CSPM rule |\n| **Baseline** | CIS AWS Benchmark 2.1.1 | CSPM; automated check |\n| **Guardrail** | Block creation of public bucket | Service control policy; pipeline check |\n\n## CSPM and continuous compliance\n\n**Cloud Security Posture Management (CSPM)** tools scan cloud configuration and compare to policy and benchmarks. They report misconfigurations and compliance drift. Use them continuously, not only at deploy time. **Continuous compliance** means always measuring against frameworks (e.g. CIS, regulatory) and remediating gaps. Automate where possible.\n\n**How to run posture in practice:** (1) Define policy and baseline (e.g. CIS or internal). (2) Enable CSPM or equivalent; connect to all accounts. (3) Triage findings: fix, accept with approval, or false positive. (4) Set SLA (e.g. critical fixed in 24h). (5) Report posture (e.g. % compliant) to leadership and track trend.\n\n## Key takeaway\n\nStrong cloud posture requires clear policy, baselines, and continuous assessment (CSPM) and compliance. Automate checks and remediation to keep posture high.\n\n## Exam alignment\n\nAWS Security; Microsoft SC-200 (posture; governance).', 32, 3);

-- ========== BH-SPEC-CLOUD: LESSONS (Modules 2–4) ==========
INSERT INTO public.lessons (id, module_id, title, description, content_markdown, duration_minutes, order_index) VALUES
  ('e0000000-0000-4000-8000-000000000024', 'd0000000-0000-4000-8000-000000000022', 'Cloud IAM and Roles', 'Users, roles, and policies in the cloud.', E'# Cloud IAM and Roles\n\n## Introduction\n\nThis lesson covers identity and access in the cloud: users, roles, service accounts, and policy. You will learn how to design least-privilege access for workloads and humans.\n\n## Objectives\n\nBy the end of this lesson you will be able to:\n\n- Explain the difference between users, roles, and service accounts in major clouds.\n- Write and apply policies that follow least privilege.\n- Use roles for workloads and avoid long-lived keys where possible.\n\n## Users, roles, and service accounts\n\n**Users** (or identities) represent people or applications. **Roles** are permissions that can be assumed; they do not have permanent credentials. **Service accounts** (or similar) are identities for applications and workloads. Prefer **role-based** access for workloads: the workload assumes a role and gets temporary credentials; no long-lived keys to steal. For humans, use strong authentication and assign roles or groups with minimal permissions.\n\n| Identity type | Credentials | Typical use |\n|---------------|-------------|-------------|\n| **User** | Long-lived (password, access key) | Humans; avoid keys where possible |\n| **Role** | Temporary (assumed) | Workloads (EC2, Lambda); no keys |\n| **Service account** | Key or workload identity | Apps; restrict and rotate keys |\n\n**Example:** An EC2 instance needs to read from S3. Instead of storing an access key on the instance, attach an IAM role to the instance. The instance assumes the role and receives temporary credentials; no key to steal. For a human, use federation (e.g. Azure AD) and assign an IAM role with only the permissions needed for their job.\n\n## Policies\n\n**Policies** define what actions are allowed on what resources. They are often expressed as "effect, action, resource, condition". Use **least privilege**: grant only the actions and resources needed. Avoid wildcards unless necessary. Use **conditions** (e.g. IP, MFA) to further restrict. Review policies regularly; remove unused permissions.\n\n**How to write one least-privilege policy:** (1) List the exact actions the identity needs (e.g. s3:GetObject, s3:ListBucket). (2) Restrict to specific resources (e.g. arn:aws:s3:::my-bucket/*). (3) Add conditions if useful (e.g. MFA, source IP). (4) Deny by default; allow only what is listed. (5) Test and then remove any unused actions.\n\n## Key takeaway\n\nCloud IAM uses users, roles, and policies. Prefer roles for workloads; apply least privilege and conditions; avoid long-lived keys.\n\n## Exam alignment\n\nAWS Security; Microsoft SC-200 (identity and access in cloud).', 30, 1),
  ('e0000000-0000-4000-8000-000000000025', 'd0000000-0000-4000-8000-000000000022', 'Conditional Access and Zero Trust in Cloud', 'Context-aware access control.', E'# Conditional Access and Zero Trust in Cloud\n\n## Introduction\n\nThis lesson covers conditional access and zero trust in the cloud: using device, location, and risk to allow or deny access. You will learn how to design and implement conditional policies.\n\n## Objectives\n\nBy the end of this lesson you will be able to:\n\n- Define conditional access and how it differs from static rules.\n- Use signals: device, location, risk, sensitivity.\n- Design policies that balance security and usability.\n\n## Conditional access\n\n**Conditional access** evaluates each request against conditions (e.g. user from managed device, from corporate network, low risk). If conditions are met, access is granted; otherwise access is blocked or step-up (e.g. MFA) is required. This enables "allow from trusted context, require more proof otherwise" without blocking everyone.\n\n**Example:** Policy: "Allow access to the admin portal only if device is managed and compliant AND user completed MFA." A user on a personal phone would be blocked or required to use a managed device; a user on a corporate laptop with MFA would be allowed.\n\n## Signals and policy\n\nSignals include: **device** (managed, compliant, encrypted); **location** (IP, country); **risk** (sign-in risk, user risk from behaviour); **sensitivity** of the resource. Policies combine signals: e.g. "Allow access to sensitive app only from managed device and with MFA." Start with high-sensitivity resources and expand. Test to avoid locking out users.\n\n| Signal | Example | Use in policy |\n|--------|--------|---------------|\n| Device | Managed, compliant | Block or require managed device for sensitive app |\n| Location | Country, IP range | Block high-risk countries; require corporate IP for admin |\n| Risk | Sign-in risk (e.g. impossible travel) | Block or require MFA when risk is high |\n| Sensitivity | App classification | Stricter policy for high-sensitivity app |\n\n**How to design one policy:** (1) Choose the resource or app. (2) Define who should have access (group or role). (3) Add conditions: e.g. managed device + MFA. (4) Set action: allow, block, or require step-up. (5) Test with a pilot group; then roll out. (6) Monitor for lockouts and tune.\n\n## Key takeaway\n\nConditional access uses device, location, and risk to make access decisions. Design policies that protect sensitive resources while allowing legitimate use.\n\n## Exam alignment\n\nMicrosoft SC-200 (conditional access; identity).', 28, 2),
  ('e0000000-0000-4000-8000-000000000026', 'd0000000-0000-4000-8000-000000000022', 'Securing Cloud Data', 'Encryption, classification, and DLP.', E'# Securing Cloud Data\n\n## Introduction\n\nThis lesson covers how to protect data in the cloud: encryption at rest and in transit, classification, and data loss prevention. You will learn provider and customer responsibilities for data security.\n\n## Objectives\n\nBy the end of this lesson you will be able to:\n\n- Apply encryption at rest and in transit for cloud data.\n- Use classification and labelling to protect sensitive data.\n- Describe DLP and retention in the cloud.\n\n## Encryption\n\n**At rest**: Use provider or customer-managed encryption for storage and databases; understand key management (provider-managed vs customer-managed keys). **In transit**: TLS for all traffic; avoid plaintext between services. Enforce encryption via policy and configuration checks.\n\n| Where | Responsibility | Example |\n|-------|-----------------|--------|\n| **At rest** | Enable encryption; choose key type | S3 bucket encryption; CMK for regulated data |\n| **In transit** | TLS everywhere | Enforce HTTPS; TLS between services |\n| **Key management** | Provider vs customer-managed | Customer-managed for key control and compliance |\n\n**Example:** For a database holding PII, enable encryption at rest (e.g. AWS RDS encryption or Azure SQL TDE). Use customer-managed keys if you need to control rotation or meet a compliance requirement. Ensure the application connects with TLS so data in transit is encrypted.\n\n## Classification and DLP\n\n**Classification** labels data by sensitivity (e.g. public, internal, confidential). Use labels to apply policies (e.g. encryption, access, retention). **Data loss prevention (DLP)** detects or blocks sensitive data from leaving defined boundaries (e.g. block upload of PII to personal email). Use classification and DLP together to protect data wherever it lives.\n\n**In practice:** Start with "where is our sensitive data?" (e.g. S3 buckets, databases, SharePoint). Enable encryption and restrict access. Add classification labels so users and systems know what is sensitive. Use DLP rules to block or alert when confidential data is shared externally or copied to unmanaged devices.\n\n## Key takeaway\n\nEncrypt data at rest and in transit; classify data and apply policy; use DLP to prevent inappropriate exposure or exfiltration.\n\n## Exam alignment\n\nAWS Security; Microsoft SC-200 (data protection).', 30, 3),
  ('e0000000-0000-4000-8000-000000000027', 'd0000000-0000-4000-8000-000000000023', 'Network Security in the Cloud', 'VPC, firewalls, and segmentation.', E'# Network Security in the Cloud\n\n## Introduction\n\nThis lesson covers network security in the cloud: virtual networks, firewalls, segmentation, and secure connectivity. You will learn how to design and operate secure cloud networks.\n\n## Objectives\n\nBy the end of this lesson you will be able to:\n\n- Design VPCs and subnets for segmentation and least privilege.\n- Use security groups, NACLs, and firewalls to control traffic.\n- Implement secure connectivity (VPN, private link).\n\n## VPC and segmentation\n\n**Virtual networks** (VPC, VNet) isolate your resources. Use **subnets** to segment (e.g. public, private, data). Place only what must be public in public subnets; use private subnets and NAT for outbound-only access. Segment by workload or trust zone so a breach in one segment does not expose everything.\n\n**Example:** One VPC with three tiers: **public** — load balancer only; **app** — web/app servers, no direct internet; **data** — databases, no direct internet, only from app tier. Security group on app tier: allow 443 from load balancer SG only. Security group on data tier: allow 5432 (or DB port) from app SG only. That limits lateral movement.\n\n## Security groups and firewalls\n\n**Security groups** (or similar) act as stateful firewalls at the instance or interface level. Allow only required traffic (e.g. 443 from load balancer to app tier). **Network ACLs** add subnet-level stateless rules. **Web application firewalls (WAF)** protect HTTP/HTTPS. Use layered controls: WAF for web, security groups for instance, NACL for subnet.\n\n| Control | Layer | Use |\n|---------|-------|-----|\n| **WAF** | Application (HTTP/HTTPS) | Block bad requests; rate limit |\n| **Security group** | Instance / interface | Allow only needed ports and sources |\n| **NACL** | Subnet | Subnet-level allow/deny (stateless) |\n\n**How to lock down one tier:** (1) List required traffic (e.g. app tier needs 443 from LB, 22 from bastion). (2) Create security group with only those rules. (3) Attach to instances. (4) Default deny; no 0.0.0.0/0 unless required and documented.\n\n## Key takeaway\n\nSegment with VPC and subnets; control traffic with security groups and firewalls; use secure connectivity for hybrid and partner access.\n\n## Exam alignment\n\nAWS Security; Microsoft SC-200 (network security).', 30, 1),
  ('e0000000-0000-4000-8000-000000000028', 'd0000000-0000-4000-8000-000000000023', 'Logging and Monitoring in the Cloud', 'Centralised logging and detection.', E'# Logging and Monitoring in the Cloud\n\n## Introduction\n\nThis lesson covers logging and monitoring in the cloud: what to log, how to centralise and retain logs, and how to use them for detection and response. You will learn cloud-native and hybrid approaches.\n\n## Objectives\n\nBy the end of this lesson you will be able to:\n\n- Enable and collect key logs (identity, network, resource, audit).\n- Centralise logs and protect them from tampering.\n- Use logs for alerting, detection, and investigation.\n\n## What to log\n\nLog **identity** (sign-ins, permission changes), **network** (flow logs, firewall), **resource** (API calls, configuration changes), and **application** logs. Ensure logs include enough context (user, resource, timestamp, result). Many clouds have central audit logs (e.g. CloudTrail, Azure Activity); enable them and send to a secure store.\n\n| Log type | Example | Why |\n|----------|---------|-----|\n| **Identity** | Sign-in, role assumption, MFA | Account takeover; privilege abuse |\n| **Resource** | API calls (create, delete, change config) | Misconfiguration; abuse; forensics |\n| **Network** | Flow logs, firewall | Lateral movement; exfiltration |\n| **Application** | App errors, access | Abuse; debugging |\n\n**Example:** Enable CloudTrail (or equivalent) in all accounts and regions; send to a central S3 bucket or log analytics with restricted access. Enable VPC flow logs for subnets that hold sensitive workloads. That gives you "who did what" and "what traffic flowed" for detection and investigation.\n\n## Centralisation and retention\n\nSend logs to a central store (e.g. SIEM, cloud log analytics) so they can be correlated and retained per policy. Protect the log store: restrict write/delete, encrypt, and consider immutability. Retain according to regulation and incident response needs.\n\n## Detection and response\n\nUse logs for **alerting** (thresholds, known-bad patterns) and **detection** (analytics, anomaly). Integrate with incident response: when an alert fires, runbooks and playbooks guide investigation and containment. Test detection and response regularly.\n\n**In practice:** Define a small set of critical alerts first (e.g. root login, disable MFA, delete bucket, create IAM user). Tune to reduce noise. Add anomaly-based detection over time. Ensure someone is assigned to respond and that logs are retained long enough for post-incident review.\n\n## Key takeaway\n\nLog identity, network, and resource activity; centralise and protect logs; use them for detection and response.\n\n## Exam alignment\n\nAWS Security; Microsoft SC-200 (logging; monitoring).', 30, 2),
  ('e0000000-0000-4000-8000-000000000029', 'd0000000-0000-4000-8000-000000000023', 'Containers and Serverless Security', 'Securing modern workload types.', E'# Containers and Serverless Security\n\n## Introduction\n\nThis lesson covers security for containers and serverless workloads: image and function security, runtime protection, and supply chain. You will learn how to secure these common cloud patterns.\n\n## Objectives\n\nBy the end of this lesson you will be able to:\n\n- Secure container images (scanning, base images, supply chain).\n- Apply runtime security for containers and functions.\n- Describe serverless-specific risks and controls.\n\n## Container security\n\n**Images**: Use minimal base images; scan for vulnerabilities; sign and verify images. **Runtime**: Run as non-root; use read-only filesystem where possible; limit capabilities. **Orchestration**: Secure the control plane; use network policies; restrict pod-to-pod and external access. **Supply chain**: Use trusted registries; verify image provenance.\n\n| Area | Control | Example |\n|------|---------|--------|\n| **Image** | Scan; minimal base | Scan in pipeline; use Alpine or distroless |\n| **Runtime** | Non-root; read-only | Run as UID 1000; readOnlyRootFilesystem |\n| **Orchestration** | Network policy; RBAC | Deny all; allow only needed pod-to-pod |\n| **Supply chain** | Sign; verify | Sign images; verify before deploy |\n\n**Example:** In CI/CD, build the image, run a vulnerability scan (e.g. Trivy), and fail the pipeline if critical or high vulnerabilities are present. Use a minimal base image to reduce attack surface. At runtime, run the container as non-root and with read-only filesystem where possible.\n\n## Serverless security\n\n**Functions** (e.g. Lambda, Azure Functions): Apply least privilege to function roles; do not store secrets in code; use short timeouts and minimal permissions. **Event sources**: Validate and sanitise inputs; protect event queues. **Dependencies**: Scan and update libraries. Serverless reduces OS management but shifts focus to identity, code, and data.\n\n**In practice:** For each function, assign an IAM role with only the permissions that function needs (e.g. read from one S3 bucket, write to one DynamoDB table). Store secrets in a vault or managed service (e.g. Secrets Manager); never in environment variables or code. Scan dependencies in the build; set a short timeout to limit impact of runaway execution.\n\n## Key takeaway\n\nContainers and serverless need image/function security, runtime protection, and supply chain controls. Apply least privilege and secure the full pipeline.\n\n## Exam alignment\n\nAWS Security; Microsoft SC-200 (workload security).', 32, 3),
  ('e0000000-0000-4000-8000-00000000002a', 'd0000000-0000-4000-8000-000000000024', 'Cloud Incident Response', 'Detecting and responding to cloud incidents.', E'# Cloud Incident Response\n\n## Introduction\n\nThis lesson covers incident response in the cloud: detection, containment, and recovery. You will learn how cloud changes some aspects of IR and how to prepare.\n\n## Objectives\n\nBy the end of this lesson you will be able to:\n\n- Detect incidents using cloud logs and native tools.\n- Contain by isolating resources, revoking access, and disabling accounts.\n- Recover and verify; use automation where appropriate.\n\n## Detection\n\nUse cloud audit logs, flow logs, and security tools to detect anomalies and known-bad activity. Correlate with identity, network, and resource changes. Have playbooks for common scenarios (e.g. compromised credential, crypto mining, data exfiltration).\n\n**Example scenario:** Unusual API calls from a user at 3 a.m. — create EC2 instances, run mining software. Detection: CloudTrail shows RunInstances, unusual region or AMI. Playbook: revoke user credentials, terminate instances, check for persistence (new IAM users, Lambda), preserve logs.\n\n## Containment\n\nContain by: **isolating** affected resources (e.g. detach from network, disable); **revoking** compromised credentials and roles; **blocking** malicious IPs or domains at WAF or firewall. In cloud, you can do this quickly via API; automate critical containment steps. Preserve evidence (logs, snapshots) before making destructive changes.\n\n| Step | Action | Cloud-specific |\n|------|--------|----------------|\n| **Isolate** | Stop affected resources | Terminate instance; disable Lambda; revoke role |\n| **Revoke** | Remove attacker access | Disable IAM user; remove keys; revoke assumed roles |\n| **Block** | Prevent further access | Security group deny; WAF block IP; SCP restrict |\n| **Preserve** | Evidence | Snapshot volume; export CloudTrail; retain logs |\n\n**In practice:** Have runbooks that say "if we see X, run script Y or do steps Z." For credential compromise, step 1 is revoke (disable user, remove keys); then isolate any resources they created. Use automation (e.g. Lambda triggered by alert) for the first critical actions so containment is fast.\n\n## Recovery and lessons learned\n\nRecover by rebuilding from known-good images or restoring from backup; verify integrity. Update configurations and credentials. Document timeline and root cause; update detection and controls to prevent recurrence.\n\n## Key takeaway\n\nCloud IR uses cloud-native logs and tools for detection and containment. Prepare playbooks and automate where possible; preserve evidence and learn from each incident.\n\n## Exam alignment\n\nAWS Security; Microsoft SC-200 (incident response).', 32, 1),
  ('e0000000-0000-4000-8000-00000000002b', 'd0000000-0000-4000-8000-000000000024', 'Compliance and Assurance in the Cloud', 'Meeting regulatory and audit requirements.', E'# Compliance and Assurance in the Cloud\n\n## Introduction\n\nThis lesson covers how to achieve and demonstrate compliance in the cloud: frameworks, evidence, and audits. You will learn how providers and customers share compliance responsibilities.\n\n## Objectives\n\nBy the end of this lesson you will be able to:\n\n- Use provider compliance programmes and certifications.\n- Map customer controls to frameworks and collect evidence.\n- Prepare for and support audits in the cloud.\n\n## Provider compliance\n\nCloud providers publish compliance certifications (e.g. SOC 2, ISO 27001, sector-specific). Use them to understand what the provider has been audited for. Your compliance still depends on how you use the cloud: your configuration, identity, and data. Provider certifications reduce but do not remove your burden.\n\n**Example:** AWS has SOC 2, ISO 27001, etc. That covers the security of the cloud (infrastructure). Your responsibility: how you configure IAM, encryption, logging, and access. For a PCI scope, you still need to map your controls (e.g. encryption at rest, access control) and provide evidence; the provider''s report covers their part only.\n\n## Customer controls and evidence\n\nMap your controls (config, IAM, encryption, logging) to your framework (e.g. CIS, NIST, PCI). Collect evidence: configuration exports, logs, policy documents. Use CSPM and compliance tools to automate evidence collection and gap reporting. Maintain an inventory of in-scope resources and their compliance status.\n\n| Step | Action |\n|------|--------|\n| **Scope** | Define in-scope accounts, regions, services |\n| **Map** | Control → requirement (e.g. encryption → PCI 3.4) |\n| **Evidence** | Config export; log sample; policy; CSPM report |\n| **Gap** | Fix or document exception with plan |\n\n**In practice:** Use CSPM to run continuous compliance (e.g. CIS benchmark). Export "evidence" reports (e.g. encryption status, public access) regularly. When the auditor asks "how do you ensure encryption at rest?", show the control (e.g. default encryption policy) and the CSPM or config evidence. Keep a control matrix: requirement | control | evidence | owner.\n\n## Key takeaway\n\nCompliance in the cloud uses provider certifications and your own controls and evidence. Automate mapping and evidence; prepare for audits with clear documentation.\n\n## Exam alignment\n\nAWS Security; Microsoft SC-200 (compliance).', 30, 2),
  ('e0000000-0000-4000-8000-00000000002c', 'd0000000-0000-4000-8000-000000000024', 'Security Automation and DevSecOps in the Cloud', 'Automating security in CI/CD and operations.', E'# Security Automation and DevSecOps in the Cloud\n\n## Introduction\n\nThis lesson covers how to integrate security into cloud development and operations through automation, pipeline checks, and DevSecOps practices. You will learn how to shift left and maintain security at speed.\n\n## Objectives\n\nBy the end of this lesson you will be able to:\n\n- Integrate security checks into CI/CD pipelines (scanning, policy as code).\n- Use infrastructure as code to enforce and audit configuration.\n- Describe DevSecOps culture and tooling in the cloud.\n\n## Security in the pipeline\n\n**Shift left** means finding and fixing issues early: in code, in dependencies, and at deploy time. In CI/CD, run **SAST** (static analysis), **dependency scanning**, and **container/image scanning** before merge or deploy. Use **policy as code** to block deployments that violate security rules (e.g. public bucket, missing encryption). Failing the pipeline prevents insecure releases.\n\n| Stage | Check | Example |\n|-------|--------|--------|\n| **Code** | SAST | Static analysis for secrets, SQLi |\n| **Dependencies** | Scan | CVE in libraries; block if critical |\n| **Build** | Image scan | Vulnerabilities in container image |\n| **Deploy** | IaC / policy | Block public bucket; require encryption |\n\n**Example:** In the pipeline: (1) SAST runs on commit; fails if high/critical. (2) Dependency scan runs; fails if known vulnerable package. (3) Container image is built and scanned; fails if critical CVE. (4) Terraform plan is checked by a policy tool; fails if resource has public access. Only if all pass does the deploy proceed.\n\n## Infrastructure as code\n\n**Infrastructure as code (IaC)** (e.g. Terraform, CloudFormation) defines environment and configuration in version-controlled files. Scan IaC for misconfigurations before apply; use approved modules and patterns. IaC makes configuration repeatable, auditable, and testable. Enforce tagging, networking, and encryption via IaC standards and automated checks.\n\n**In practice:** Store all cloud config in Git. Run an IaC scanner (e.g. Checkov, tfsec) in the pipeline; block merge or deploy if high-severity misconfigurations are found. Use modules and policy-as-code so "no public bucket" and "encryption required" are enforced by default. That way secure is the path of least resistance.\n\n## Key takeaway\n\nSecurity automation and DevSecOps in the cloud integrate scanning and policy into pipelines and IaC. Shift left and use automation so security keeps pace with delivery.\n\n## Exam alignment\n\nAWS Security; Microsoft SC-200 (automation; DevSecOps).', 32, 3);

-- ========== BH-SPEC-GRC (Advanced GRC): MODULES ==========
INSERT INTO public.modules (id, course_id, title, description, order_index) VALUES
  ('d0000000-0000-4000-8000-000000000031', 'a0000000-0000-4000-8000-00000000000b', 'Enterprise Risk Management', 'ERM framework, risk appetite, and board-level risk.', 1),
  ('d0000000-0000-4000-8000-000000000032', 'a0000000-0000-4000-8000-00000000000b', 'IT Risk Identification and Analysis', 'IT-specific risk scenarios and quantitative methods.', 2),
  ('d0000000-0000-4000-8000-000000000033', 'a0000000-0000-4000-8000-00000000000b', 'Risk Response and Monitoring', 'Response strategies, KRIs, and risk reporting.', 3),
  ('d0000000-0000-4000-8000-000000000034', 'a0000000-0000-4000-8000-00000000000b', 'Governance and Reporting', 'Risk governance, committees, and assurance.', 4);

-- ========== BH-SPEC-GRC: LESSONS (Module 1 — Enterprise Risk Management) ==========
INSERT INTO public.lessons (id, module_id, title, description, content_markdown, duration_minutes, order_index) VALUES
  ('e0000000-0000-4000-8000-000000000031', 'd0000000-0000-4000-8000-000000000031', 'Enterprise Risk Management Frameworks', 'ERM concepts and how IT risk fits.', E'# Enterprise Risk Management Frameworks\n\n## Introduction\n\nThis lesson introduces enterprise risk management (ERM) and how IT and cyber risk sit within it. You will learn common ERM frameworks and the role of the risk function.\n\n## Objectives\n\nBy the end of this lesson you will be able to:\n\n- Define ERM and how it differs from siloed risk management.\n- Name common ERM frameworks (e.g. COSO, ISO 31000).\n- Explain how IT and cyber risk are integrated into ERM.\n\n## What is ERM?\n\n**Enterprise risk management** is the discipline of identifying, assessing, responding to, and monitoring risk across the entire organisation in a coordinated way. It ensures that risk is considered at strategy and decision level and that appetite and tolerance are defined and communicated. ERM moves away from risk managed only within departments (e.g. IT, finance) toward a unified view that supports the board and executive.\n\n**Example:** In a siloed approach, IT might have a risk register and finance another; the board sees two separate reports. In ERM, there is one (or linked) register: operational risk (including IT), financial risk, strategic risk, compliance risk. The board sees one heat map and one set of top risks, so it can prioritise investment and accept risk consistently.\n\n## Frameworks\n\n**COSO ERM** (Committee of Sponsoring Organizations) is widely used; it emphasises strategy, governance, and culture. **ISO 31000** is an international standard for risk management that can be applied to any organisation or risk type. Both support a cycle of identify, assess, treat, monitor, and communicate. IT and cyber risk are risk categories within ERM; they use the same language (appetite, tolerance, treatment) and feed into the same reporting.\n\n| Framework | Focus | Use |\n|-----------|--------|-----|\n| **COSO ERM** | Strategy, governance, culture | Board-level ERM; widely referenced |\n| **ISO 31000** | Risk management process | Any risk type; international |\n\n## Integrating IT risk\n\nIT and cyber risk should be identified and assessed using the same ERM process: same risk register or linked registers, same severity scales, and reporting into the same committees. This allows leadership to see all risk in one place and to prioritise across operational, financial, and technology risk.\n\n**In practice:** Your IT risk register should use the same likelihood/impact scale and risk levels as the rest of the enterprise. Report IT and cyber risks in the same pack as operational and financial risks (e.g. top 10 enterprise risks include 2–3 IT/cyber). Use the same treatment options (accept, mitigate, transfer, avoid) and approval levels so the board sees one coherent picture.\n\n## Key takeaway\n\nERM provides a unified approach to risk across the organisation. Use established frameworks and integrate IT and cyber risk into the same governance and reporting.\n\n## Exam alignment\n\nCRISC (Enterprise risk; ERM frameworks).', 32, 1),
  ('e0000000-0000-4000-8000-000000000032', 'd0000000-0000-4000-8000-000000000031', 'Risk Appetite and Tolerance', 'Defining how much risk the organisation accepts.', E'# Risk Appetite and Tolerance\n\n## Introduction\n\nThis lesson covers risk appetite and risk tolerance: how organisations define how much risk they are willing to accept and how that guides decisions. You will learn how to articulate and use appetite and tolerance in practice.\n\n## Objectives\n\nBy the end of this lesson you will be able to:\n\n- Define risk appetite and risk tolerance and distinguish them.\n- Describe how appetite is set and communicated (board, statements).\n- Use tolerance to make accept/mitigate/avoid decisions.\n\n## Risk appetite\n\n**Risk appetite** is the amount and type of risk the organisation is willing to take on in pursuit of its objectives. It is a strategic statement, often set by the board: e.g. "We accept moderate operational risk in exchange for growth but have low appetite for reputational or regulatory risk." Appetite is usually expressed at a high level (e.g. by category or impact type) and may be qualitative or linked to metrics.\n\n## Risk tolerance\n\n**Risk tolerance** is the acceptable variation around objectives or the maximum level of risk for a specific area. It is more operational: e.g. "We tolerate up to X hours of unplanned downtime per year" or "We do not accept any unmitigated critical vulnerabilities in internet-facing systems." Tolerance is used to decide whether a specific risk is acceptable or must be treated. Breach of tolerance typically triggers escalation or mandatory treatment.\n\n| Concept | Level | Example |\n|---------|--------|--------|\n| **Appetite** | Strategic | "Low appetite for regulatory or reputational risk" |\n| **Tolerance** | Operational | "No critical vulns unmitigated on internet-facing systems" |\n\n**Example:** Appetite says "we accept moderate cyber risk in return for digital innovation." Tolerance says "we do not accept any critical risk without a documented treatment plan and owner." When you assess a new risk as critical, tolerance says you must mitigate, transfer, or avoid—you cannot simply accept without board-level approval and possibly an appetite exception.\n\n## Using appetite and tolerance\n\nUse appetite to guide strategy and resource allocation; use tolerance to evaluate individual risks and control design. Report when risks approach or exceed tolerance; review appetite periodically (e.g. annually) and when strategy or environment changes.\n\n**In practice:** When a risk owner asks "can we accept this risk?", check: (1) Does it exceed tolerance? If yes, acceptance is not allowed without escalation. (2) Is it within appetite? If the risk is strategic (e.g. new product), document how it aligns with appetite. (3) Document acceptance with approver and review date.\n\n## Key takeaway\n\nRisk appetite sets strategic willingness to take risk; tolerance sets operational limits. Define both clearly and use them to drive consistent risk decisions.\n\n## Exam alignment\n\nCRISC (Risk appetite; tolerance).', 30, 2),
  ('e0000000-0000-4000-8000-000000000033', 'd0000000-0000-4000-8000-000000000031', 'Board and Executive Risk Reporting', 'Reporting risk to the board and C-suite.', E'# Board and Executive Risk Reporting\n\n## Introduction\n\nThis lesson covers how to report risk effectively to the board and executive team. You will learn what they need to fulfil their governance duties and how to present IT and cyber risk in that context.\n\n## Objectives\n\nBy the end of this lesson you will be able to:\n\n- List what the board needs: top risks, trend, appetite/tolerance, decisions.\n- Structure board and executive risk reports.\n- Explain how IT risk fits into enterprise risk reporting.\n\n## Board responsibilities\n\nThe board oversees strategy and risk; it does not manage day-to-day operations. It needs a clear view of **top risks**, **trend** (improving or worsening), **alignment with appetite and tolerance**, and **decisions required** (e.g. accept residual risk, approve investment). Reports should be concise, comparable over time, and focused on what the board can act on.\n\n## Report structure\n\nTypical structure: **executive summary** (2–3 sentences); **risk landscape** (top risks, heat map or list); **metrics** (e.g. open critical risks, control coverage); **trend and outlook**; **decisions or asks** (e.g. approval for risk acceptance, budget). Avoid jargon; use business impact. Provide detail in appendices or on request.\n\n| Section | Content |\n|---------|--------|\n| **Summary** | 2–3 sentences: posture, main message |\n| **Top risks** | 5–10 risks with level, trend, owner |\n| **Metrics** | Open critical/high; breach of tolerance; KRIs |\n| **Trend** | Improving / stable / worsening; why |\n| **Decisions** | What we need: approval, budget, direction |\n\n**Example — one board slide:** "Cyber risk remains a top-5 enterprise risk. We have 2 critical risks with treatment plans and 1 awaiting board approval for acceptance. Trend: stable. Ask: Approve risk acceptance for [X] with annual review." That gives the board the picture and the decision.\n\n## IT and cyber in the picture\n\nIT and cyber risk should appear in the same report as other enterprise risks, with consistent severity and treatment status. Highlight systemic or strategic IT risks (e.g. resilience, major projects, regulatory). Ensure the board understands both likelihood and impact in business terms.\n\n**In practice:** Do not report "3 critical vulnerabilities." Report "Risk: disruption to customer platform from unpatched systems; impact: revenue and reputation; we are mitigating by [plan]; need [resource/approval]." Translate technical risk into business impact and clear asks.\n\n## Key takeaway\n\nBoard and executive reporting should be clear, consistent, and decision-oriented. Integrate IT and cyber risk into enterprise risk reporting so leadership sees one picture.\n\n## Exam alignment\n\nCRISC (Governance; reporting).', 28, 3);

-- ========== BH-SPEC-GRC: LESSONS (Module 2 — IT Risk Identification and Analysis) ==========
INSERT INTO public.lessons (id, module_id, title, description, content_markdown, duration_minutes, order_index) VALUES
  ('e0000000-0000-4000-8000-000000000034', 'd0000000-0000-4000-8000-000000000032', 'IT Risk Scenarios and Threat Modelling', 'Structured identification of IT risk.', E'# IT Risk Scenarios and Threat Modelling\n\n## Introduction\n\nThis lesson covers how to identify IT risk through scenarios and threat modelling. You will learn how to build realistic scenarios that link threats, vulnerabilities, and business impact.\n\n## Objectives\n\nBy the end of this lesson you will be able to:\n\n- Construct IT risk scenarios (threat, vulnerability, asset, impact).\n- Use threat modelling techniques (e.g. STRIDE, attack trees).\n- Prioritise scenarios for assessment and treatment.\n\n## Risk scenarios\n\nA **risk scenario** describes a specific way harm could occur. For IT: "An attacker exploits a vulnerability in the web application to access customer data." Scenarios should name the threat, the vulnerability or vector, the asset at risk, and the impact. Good scenarios are concrete enough to assess and treat; they avoid vague "something could go wrong" statements.\n\n**Example — full scenario:** *Threat:* External attacker. *Vulnerability/vector:* Unpatched critical CVE in customer-facing API. *Asset:* Customer PII in database. *Impact:* Data breach; regulatory fines; reputational damage. That scenario can be assessed (likelihood, impact), treated (patch, WAF, monitoring), and tracked.\n\n## Threat modelling\n\n**Threat modelling** systematically identifies threats to a system or process. **STRIDE** (Spoofing, Tampering, Repudiation, Information disclosure, Denial of service, Elevation of privilege) is a common checklist. **Attack trees** break down how an attacker might achieve a goal (e.g. steal data) into steps and sub-steps. Use these to ensure coverage and to communicate with technical and business stakeholders.\n\n| STRIDE | Question | Example (web app) |\n|--------|----------|-------------------|\n| **S**poofing | Can someone pretend to be another? | Credential theft; session hijack |\n| **T**ampering | Can data be modified? | SQL injection; API manipulation |\n| **R**epudiation | Can actions be denied? | Missing or weak audit logs |\n| **I**nformation disclosure | Can data be read by unauthorised party? | Misconfig; weak encryption |\n| **D**enial of service | Can availability be reduced? | DDoS; resource exhaustion |\n| **E**levation of privilege | Can user gain higher rights? | IDOR; privilege escalation |\n\n## Prioritisation\n\nNot all scenarios can be addressed first. Prioritise by likelihood and impact (risk level), alignment with strategic objectives, and regulatory or audit focus. Maintain a risk register and review scenarios when the environment or threat landscape changes.\n\n**In practice:** Run a STRIDE session for a critical system: list threats per category, turn each into a scenario (threat + vector + asset + impact), then assess and rank. Put the top 5–10 into the risk register with owners and treatment. Re-run when the system or threat landscape changes significantly.\n\n## Key takeaway\n\nIT risk scenarios and threat modelling give structure to risk identification. Use them to prioritise and to align technical and business views of risk.\n\n## Exam alignment\n\nCRISC (Risk identification; IT risk).', 32, 1),
  ('e0000000-0000-4000-8000-000000000035', 'd0000000-0000-4000-8000-000000000032', 'Quantitative Risk Analysis', 'Using numbers in risk assessment.', E'# Quantitative Risk Analysis\n\n## Introduction\n\nThis lesson covers quantitative risk analysis: using numbers (probability, impact in currency, expected loss) to assess and compare risk. You will learn when and how to apply quantitative methods.\n\n## Objectives\n\nBy the end of this lesson you will be able to:\n\n- Define quantitative risk concepts (ALE, SLE, ARO).\n- Apply simple quantitative models to IT risk.\n- Understand limitations and when to use qualitative instead.\n\n## Key concepts\n\n**SLE (Single Loss Expectancy)** is the expected loss if a risk event occurs once (e.g. cost of a data breach). **ARO (Annual Rate of Occurrence)** is how often the event is expected per year. **ALE (Annual Loss Expectancy)** = SLE × ARO; it is the expected loss per year. These support cost-benefit analysis: if the cost of a control is less than the reduction in ALE, the control may be justified.\n\n| Term | Meaning | Example |\n|------|---------|--------|\n| **SLE** | Loss if event happens once | Data breach: $500K (remediation, fines, reputation) |\n| **ARO** | Times per year we expect it | 0.1 (once in 10 years) |\n| **ALE** | SLE × ARO | $500K × 0.1 = $50K per year |\n\n**Worked example:** Ransomware on file server. SLE = $200K (recovery, downtime, possible ransom). ARO = 0.2 (estimate: once every 5 years). ALE = $40K. If a control (e.g. backup and restore hardening) costs $10K per year and reduces ARO to 0.05, new ALE = $10K; reduction = $30K. Control cost ($10K) < reduction ($30K) → control is justified.\n\n## Applying quantitative analysis\n\nGather data: historical incidents, industry benchmarks (e.g. breach cost studies), and expert estimates. Use ranges (e.g. low/medium/high impact) when point estimates are uncertain. Document assumptions and update when new data is available. Quantitative analysis is most useful when you have reasonable data and need to compare options (e.g. which control to fund).\n\n## Limitations\n\nData may be scarce or biased; rare but severe events are hard to quantify. Qualitative assessment is often more practical for many risks. Use quantitative where it adds value (e.g. business case for investment) and qualitative or hybrid elsewhere.\n\n**In practice:** Use ALE for a few high-impact risks where you have or can estimate data (e.g. breach, major outage). Use the result to argue for or against a control. For most risks, qualitative (high/medium/low) is enough; reserve quantitative for decisions that need a number (e.g. board business case).\n\n## Key takeaway\n\nQuantitative risk analysis uses SLE, ARO, and ALE to support decisions. Use it where data and context allow; combine with qualitative methods as needed.\n\n## Exam alignment\n\nCRISC (Risk analysis; quantitative methods).', 32, 2),
  ('e0000000-0000-4000-8000-000000000036', 'd0000000-0000-4000-8000-000000000032', 'Control Design and Effectiveness', 'Designing and assessing controls.', E'# Control Design and Effectiveness\n\n## Introduction\n\nThis lesson covers how to design controls that reduce IT risk and how to assess whether they are effective. You will learn control design principles and testing methods.\n\n## Objectives\n\nBy the end of this lesson you will be able to:\n\n- Design controls that address risk and are testable.\n- Assess control effectiveness (design and operating effectiveness).\n- Identify control gaps and compensating controls.\n\n## Control design\n\nControls should be **aligned to risk**: each control addresses one or more risk scenarios. They should be **specific** (clear what they do and who owns them) and **testable** (you can gather evidence that they operate as intended). Avoid controls that are vague or that no one can verify. Design with defence in depth where risk is high.\n\n**Example — good control:** *Control: MFA required for all privileged accounts. Risk: Unauthorised access. Owner: IAM team. Test: Run report showing 100% of privileged accounts have MFA enabled; sample 5 and verify.* That is specific, owned, and testable.\n\n## Assessing effectiveness\n\n**Design effectiveness** asks: if the control operates as designed, would it reduce the risk? **Operating effectiveness** asks: does the control actually operate as designed? Test through inquiry, observation, and reperformance. Use sampling where populations are large. Document results and any exceptions; ineffective controls create residual risk that may need additional treatment.\n\n| Assessment | Question | How to test |\n|------------|----------|-------------|\n| **Design** | Would this control reduce the risk if it worked? | Review control description vs risk |\n| **Operating** | Does it actually work as designed? | Inquiry; observation; reperformance; sample |\n\n**How to test one control:** (1) Define what "working" looks like (e.g. "All admin accounts have MFA"). (2) Gather evidence (report, config export, sample). (3) Check for exceptions (e.g. 2 accounts without MFA). (4) Conclude: effective, or ineffective with residual risk. (5) If ineffective, add treatment or compensating control.\n\n## Gaps and compensating controls\n\nA **gap** is a risk that is not fully covered by controls. **Compensating controls** are alternative controls when the primary control cannot be applied (e.g. extra monitoring when a patch cannot be installed). Document compensating controls and their limitations; review when the primary control becomes feasible.\n\n**In practice:** When you cannot implement the ideal control (e.g. cannot patch a legacy system), document: risk, primary control (not in place), compensating control (e.g. network segmentation, monitoring, reduced scope), owner, and review date. Get approval from risk owner and track until the primary control is in place or risk is accepted.\n\n## Key takeaway\n\nControls must be well designed and tested. Assess both design and operating effectiveness; address gaps with additional or compensating controls.\n\n## Exam alignment\n\nCRISC (Control design; effectiveness).', 32, 3);

-- ========== BH-SPEC-GRC: LESSONS (Module 3 — Risk Response and Monitoring) ==========
INSERT INTO public.lessons (id, module_id, title, description, content_markdown, duration_minutes, order_index) VALUES
  ('e0000000-0000-4000-8000-000000000037', 'd0000000-0000-4000-8000-000000000033', 'Risk Response Strategies', 'Accept, mitigate, transfer, avoid in depth.', E'# Risk Response Strategies\n\n## Introduction\n\nThis lesson goes deeper into risk response strategies: when to accept, mitigate, transfer, or avoid risk, and how to document and approve each. You will learn how to align response with appetite and tolerance.\n\n## Objectives\n\nBy the end of this lesson you will be able to:\n\n- Choose and justify the right response strategy for a given risk.\n- Document risk acceptance and get appropriate approval.\n- Coordinate response with treatment plans and owners.\n\n## Accept\n\n**Accept** means the organisation consciously takes the risk without further action. Use when: impact is within appetite; cost of control exceeds benefit; or treatment is not feasible yet. **Document** acceptance: risk description, rationale, approver (often senior management or board for high risk), and review date. Do not use acceptance as a default for "we did not get to it"; that is untreated risk.\n\n**How to document risk acceptance:** (1) Risk ID and one-line description. (2) Current level (e.g. medium). (3) Rationale (e.g. within appetite; control cost exceeds benefit; temporary until Q3 fix). (4) Approver name and date. (5) Review date (e.g. in 12 months or when conditions change). (6) Store in register and in committee minutes if board-approved.\n\n## Mitigate, transfer, avoid\n\n**Mitigate** — Reduce likelihood or impact with controls; most common for IT risk. **Transfer** — Shift impact to another party (insurance, contract); does not remove the risk. **Avoid** — Stop the activity or exit the risk; use when risk is unacceptable. For each response, assign an owner, set a timeline, and define how you will verify effectiveness.\n\n**Example — choosing response:** Critical risk of data breach from unpatched system. **Avoid** = decommission the system (may not be feasible). **Mitigate** = patch, segment, monitor (typical). **Transfer** = cyber insurance (reduces financial impact; still mitigate). **Accept** = only if within tolerance and explicitly approved; not "we will fix it later."\n\n## Alignment with appetite\n\nResponses must align with stated appetite and tolerance. If a risk exceeds tolerance, acceptance is inappropriate without board-level decision and possible appetite change. Escalate when proposed response conflicts with policy or tolerance.\n\n**In practice:** Before signing off acceptance, check: Is this risk within tolerance? If not, escalate. Is the approver the right level? (e.g. critical risk → board or C-suite.) Is the review date set and in the calendar? Untreated risk labelled as "accepted" creates liability and confusion.\n\n## Key takeaway\n\nRisk response must be deliberate and documented. Match strategy to risk and appetite; ensure acceptance is explicit and approved; track treatment to completion.\n\n## Exam alignment\n\nCRISC (Risk response; treatment).', 30, 1),
  ('e0000000-0000-4000-8000-000000000038', 'd0000000-0000-4000-8000-000000000033', 'Key Risk Indicators and Monitoring', 'KRIs and continuous risk monitoring.', E'# Key Risk Indicators and Monitoring\n\n## Introduction\n\nThis lesson covers key risk indicators (KRIs) and how to use them for continuous risk monitoring. You will learn how to define, track, and act on KRIs.\n\n## Objectives\n\nBy the end of this lesson you will be able to:\n\n- Define KRIs and how they differ from KPIs.\n- Select and define KRIs for IT and cyber risk.\n- Use KRIs in reporting and escalation.\n\n## What are KRIs?\n\n**Key risk indicators** are metrics that signal increasing risk exposure before an incident occurs. They are leading or concurrent indicators (e.g. number of unpatched critical systems, failed access attempts). **KPIs** measure performance or outcome; **KRIs** measure risk. Good KRIs are measurable, timely, and actionable; when a KRI breaches a threshold, it triggers review or action.\n\n| KRI vs KPI | KRI | KPI |\n|------------|-----|-----|\n| **Measures** | Risk exposure | Performance / outcome |\n| **Example** | % critical systems patched within SLA | % projects delivered on time |\n| **When it moves** | Bad = risk up | Bad = performance down |\n\n## Defining KRIs\n\nLink KRIs to risk scenarios: e.g. for "breach of customer data," a KRI might be "number of systems with unencrypted PII" or "percentage of critical systems patched within SLA." Set **thresholds**: green (acceptable), amber (watch), red (escalate or act). Review KRIs periodically; retire those that no longer reflect risk.\n\n**Example — one KRI:** *Risk:* Ransomware. *KRI:* Number of servers missing critical patches for > 7 days. *Green:* 0. *Amber:* 1–5. *Red:* > 5. *Action when red:* Incident-style review; prioritise patching; escalate to risk committee. *Owner:* IT operations. *Source:* Vulnerability scan or patch dashboard.\n\n## Using KRIs\n\nReport KRIs in risk dashboards and committee packs. When a KRI turns amber or red, investigate cause and decide: treat the risk, accept temporarily with a plan, or escalate. KRIs support a proactive risk culture: act before loss occurs.\n\n**In practice:** Start with 5–10 KRIs that map to your top risks. Report them monthly or quarterly. When one goes red, do not ignore it: assign an owner, set a target date to return to green, and report progress. Use the same KRIs over time so trend is visible.\n\n## Key takeaway\n\nKRIs signal risk exposure; use them with clear thresholds and escalation so the organisation can act before incidents.\n\n## Exam alignment\n\nCRISC (Monitoring; KRIs).', 28, 2),
  ('e0000000-0000-4000-8000-000000000039', 'd0000000-0000-4000-8000-000000000033', 'Risk Register and Lifecycle', 'Maintaining the risk register and review cycle.', E'# Risk Register and Lifecycle\n\n## Introduction\n\nThis lesson covers the risk register: what it contains, who owns it, and how to keep it current through a defined lifecycle. You will learn good practice for risk register maintenance and review.\n\n## Objectives\n\nBy the end of this lesson you will be able to:\n\n- Describe the typical contents of a risk register.\n- Define roles: owner, risk function, committee.\n- Run a risk review cycle (quarterly, annual) and keep the register current.\n\n## Risk register contents\n\nA **risk register** typically holds: risk ID, description, category, scenario, likelihood, impact, risk level, owner, response strategy, treatment plan, status, and last review date. It may link to controls and to KRIs. It should be a single source of truth for "what we know about our risk" and support reporting and audit.\n\n| Field | Purpose |\n|-------|--------|\n| ID, description, scenario | What the risk is |\n| Likelihood, impact, level | How bad and how likely |\n| Owner | Accountable for treatment |\n| Response, treatment plan | What we are doing |\n| Status, last review | Current and fresh |\n\n**Example — one row:** ID R-IT-07. Description: Ransomware on file server. Scenario: Attacker gains access via unpatched service; encrypts files. Likelihood: Possible. Impact: High. Level: High. Owner: IT Operations. Response: Mitigate. Treatment: Patch within 7 days; segment; backup and test restore. Status: In progress. Last review: 2024-01-15.\n\n## Roles\n\nThe **risk owner** is accountable for the risk and its treatment (often a business or IT lead). The **risk function** (e.g. risk manager, CISO) facilitates identification, assessment, and reporting and ensures consistency. **Committees** (e.g. risk committee) review the register, approve acceptance, and prioritise treatment. Clear roles prevent the register from becoming outdated or ignored.\n\n## Lifecycle and review\n\n**Ongoing**: Update when new risks are identified, when treatment is completed, or when incidents occur. **Periodic review**: e.g. quarterly risk committee to review top risks and treatment progress; annual full review to reassess likelihood/impact and refresh scenarios. Retire closed risks; archive with rationale. Use the register in project and change governance so new initiatives are assessed.\n\n**In practice:** Quarterly: risk committee reviews top 10–15 risks, treatment status, and any breach of tolerance; approves any new acceptances. Annual: full register review; reassess likelihood/impact for key risks; refresh scenarios; retire closed; confirm owners. Ad hoc: add risk when new project or incident; update when treatment completes.\n\n## Key takeaway\n\nThe risk register is the central record of risk and treatment. Define contents and roles; maintain it through a regular review cycle so it stays current and useful.\n\n## Exam alignment\n\nCRISC (Risk register; lifecycle).', 30, 3);

-- ========== BH-SPEC-GRC: LESSONS (Module 4 — Governance and Reporting) ==========
INSERT INTO public.lessons (id, module_id, title, description, content_markdown, duration_minutes, order_index) VALUES
  ('e0000000-0000-4000-8000-00000000003a', 'd0000000-0000-4000-8000-000000000034', 'Risk Governance and Committees', 'Structures and accountability for risk.', E'# Risk Governance and Committees\n\n## Introduction\n\nThis lesson covers risk governance: the structures, committees, and accountabilities that ensure risk is owned and reviewed at the right level. You will learn how to design and operate risk committees.\n\n## Objectives\n\nBy the end of this lesson you will be able to:\n\n- Describe typical risk governance structures (board, committee, owner).\n- Define the role of risk and audit committees.\n- Ensure clear accountability and escalation.\n\n## Governance structure\n\nThe **board** retains overall accountability for risk oversight; it sets appetite and receives top-level reporting. A **risk committee** (or equivalent) may meet regularly to review the risk register, treatment progress, and KRIs; it escalates to the board when needed. **Risk owners** are accountable for specific risks and their treatment. Larger organisations may have an enterprise risk function that coordinates and reports.\n\n| Level | Role | Typical focus |\n|-------|------|----------------|\n| **Board** | Oversight; set appetite; receive report | Top risks; trend; major decisions |\n| **Risk committee** | Review register; approve acceptance; escalate | Top risks; treatment; KRIs; escalation |\n| **Risk owner** | Own specific risk(s); drive treatment | Their risks; treatment plan; status |\n| **Risk function** | Facilitate; report; ensure consistency | Process; reporting; support owners |\n\n## Risk vs audit committee\n\n**Risk committee** focuses on risk identification, assessment, and response; it looks forward. **Audit committee** oversees internal and external audit and control effectiveness; it looks at whether controls are in place and working. They may be separate or combined; they should coordinate so that audit findings feed into risk and risk priorities guide audit focus.\n\n**In practice:** Risk committee agenda: (1) Top risks and trend. (2) Treatment progress and overdue items. (3) KRIs (any red?). (4) New or proposed risk acceptances. (5) Escalations to board. Audit committee receives audit reports and tracks findings; those findings should update the risk register (e.g. new risk or higher residual risk) and may be discussed in risk committee too.\n\n## Accountability and escalation\n\nDefine escalation rules: when does a risk go to the committee? When to the board? (e.g. breach of tolerance, new critical risk, major incident.) Document in policy and terms of reference so everyone knows who decides what.\n\n## Key takeaway\n\nRisk governance requires clear structures, committees, and accountabilities. Align risk and audit oversight and define escalation so decisions are made at the right level.\n\n## Exam alignment\n\nCRISC (Governance; risk committee).', 30, 1),
  ('e0000000-0000-4000-8000-00000000003b', 'd0000000-0000-4000-8000-000000000034', 'Assurance and Third-Party Risk', 'Internal assurance and third-party risk management.', E'# Assurance and Third-Party Risk\n\n## Introduction\n\nThis lesson covers assurance (internal audit, self-assessment) and third-party risk management. You will learn how assurance supports risk management and how to assess and manage risk from vendors and partners.\n\n## Objectives\n\nBy the end of this lesson you will be able to:\n\n- Describe how internal assurance supports risk and control.\n- Assess and monitor third-party and vendor risk.\n- Integrate assurance findings into the risk register.\n\n## Assurance\n\n**Assurance** provides independent verification that controls exist and operate. **Internal audit** is a key assurance provider; it tests controls and reports gaps. **Self-assessment** is performed by control owners; it is less independent but supports continuous awareness. Use assurance to validate risk assessments: if controls are weak, residual risk is higher. Feed findings into the risk register and treatment plans.\n\n**Example:** Internal audit finds that access reviews are not performed quarterly as required. That is a control gap. Update the risk register: the risk "Unauthorised access due to stale permissions" may have higher likelihood or the control effectiveness is reduced. Add a treatment: implement access reviews; assign owner and date. Track until closed.\n\n## Third-party risk\n\n**Third-party risk** arises from vendors, partners, and supply chain. Assess before engagement: security questionnaire, certifications, contract terms. Monitor during: performance, incidents, and changes in the third party''s posture. Have exit and contingency plans. Map critical third parties to your risk register and treat them as extended risk.\n\n| Phase | Actions |\n|-------|--------|\n| **Before** | Questionnaire; certifications (e.g. SOC 2); contract (SLAs, security, exit) |\n| **During** | Monitor performance; incidents; re-assess periodically |\n| **Exit** | Contingency plan; data return/deletion; transition |\n\n**In practice:** For critical vendors (e.g. cloud provider, payroll), have a risk register entry: "Risk: Vendor failure or breach impacts our operations/data." Controls: due diligence, contract, monitoring. KRI: vendor audit status, incident count. When the vendor has an incident, assess impact and update the risk; treat if needed.\n\n## Integrating findings\n\nWhen assurance finds control gaps, update the risk register: add or revise risks, adjust likelihood or impact, assign treatment. Track findings to closure. Use trend (e.g. repeat findings) to prioritise and to improve control design.\n\n## Key takeaway\n\nAssurance and third-party risk management validate and extend risk coverage. Integrate findings into the risk register and treatment so risk view stays current.\n\n## Exam alignment\n\nCRISC (Assurance; third-party risk).', 32, 2),
  ('e0000000-0000-4000-8000-00000000003c', 'd0000000-0000-4000-8000-000000000034', 'Risk Culture and Communication', 'Building a risk-aware culture.', E'# Risk Culture and Communication\n\n## Introduction\n\nThis lesson covers risk culture and how to communicate risk so that the organisation thinks and acts in a risk-aware way. You will learn how to embed risk in decision-making and day-to-day behaviour.\n\n## Objectives\n\nBy the end of this lesson you will be able to:\n\n- Describe what risk culture is and why it matters.\n- Communicate risk effectively to different audiences.\n- Promote risk ownership and escalation.\n\n## Risk culture\n\n**Risk culture** is the set of values, attitudes, and behaviours that determine how the organisation handles risk. A positive culture: people understand risk, own it where appropriate, and escalate when needed. A weak culture: risk is seen as "someone else''s job" or hidden. Culture is influenced by leadership tone, incentives, training, and how incidents and near-misses are treated (blame vs learning).\n\n**Example — positive:** When a team spots a vulnerability, they report it and it is fixed without blame. Risk owners know their risks and report status. Leadership talks about risk in terms of "what we need to do" not "what we are forbidden to do." **Example — weak:** People hide issues for fear of blame; risk register is updated only when chased; risk is seen as a compliance tick-box.\n\n## Communication\n\nCommunicate risk in a way that fits the audience: executives need summary and decisions; technical teams need specifics; the board needs strategy and trend. Use clear language; avoid jargon. Tell stories where they illustrate impact (e.g. "This control prevented X"). Reinforce that risk management enables the business, it does not just say no.\n\n| Audience | Message | Format |\n|----------|---------|--------|\n| **Board** | Top risks; trend; decisions needed | Short report; dashboard |\n| **Executives** | Operational risks; treatment status; asks | Report; committee pack |\n| **Teams** | Their risks; what to do; how to escalate | Training; updates; ownership list |\n\n## Ownership and escalation\n\nEveryone should know who owns which risk and when to escalate. Train on risk policy, appetite, and how to report. Reward good behaviour (e.g. raising concerns early); avoid punishing messengers. Make the risk register and KRIs visible so risk is not abstract.\n\n**In practice:** Publish a simple "risk ownership" view: risk name, owner, last review. Train new managers on "you own these risks; here is how to report and escalate." When someone raises a concern, thank them and log it; do not shoot the messenger. Include risk in performance discussions where relevant (e.g. risk owners accountable for treatment).\n\n## Key takeaway\n\nRisk culture and communication make risk management effective at scale. Build ownership and escalation; communicate clearly; reinforce that risk awareness supports the organisation.\n\n## Exam alignment\n\nCRISC (Risk culture; communication).', 28, 3);

COMMIT;
